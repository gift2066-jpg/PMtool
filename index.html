<!--
===========================================
  ê¸°íšì„œ ë·°ì–´ - ì–´ë“œë¯¼ ì‚¬ìš©ìê´€ë¦¬
===========================================
  í”„ë¡œì íŠ¸  : ì¦ê¶Œì‚¬ ì–´ë“œë¯¼
  ì‘ì„±ì    : ê¸°íšìëª…
  ìµœì´ˆì‘ì„±  : 2026-02-26

  ===== ë³€ê²½ì´ë ¥ =====
  v1.0 | 2026-02-26 | ê¸°íšìëª… | ìµœì´ˆ ì‘ì„± (ì‚¬ìš©ìê´€ë¦¬ 3í™”ë©´)
  ====================
-->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸°íšì„œ ë·°ì–´</title>
<style>
:root {
  --bg: #0b0e18;
  --surface: #131722;
  --surface-2: #1c2035;
  --surface-3: #222840;
  --border: #2a3050;
  --border-2: #1e2540;
  --accent: #4f8ef7;
  --accent-hover: #6fa3ff;
  --accent-dim: rgba(79,142,247,0.12);
  --text-primary: #e8ecf4;
  --text-secondary: #8892b0;
  --text-muted: #4a5270;
  --success: #3ecf8e;
  --warning: #f59e0b;
  --danger: #f04b4b;
  --purple: #a855f7;

  --nav-width: 260px;
  --pad-width: 290px;
  --topbar-h: 52px;
  --font: 'Pretendard','Noto Sans KR',sans-serif;
  --r: 8px;
  --r-sm: 5px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--font);background:var(--bg);color:var(--text-primary);font-size:13px;line-height:1.5;height:100vh;overflow:hidden;display:flex;flex-direction:column}

/* ============================================================
   ì „ì²´ ì‰˜
============================================================ */
.shell{display:flex;flex:1;overflow:hidden}

/* â”€â”€ ì¢Œì¸¡ í˜ì´ì§€ ëª©ë¡ íŒ¨ë„ â”€â”€ */
.nav-panel{
  width:var(--nav-width);
  background:var(--surface);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  flex-shrink:0;
}
.nav-head{
  padding:16px 16px 12px;
  border-bottom:1px solid var(--border);
  flex-shrink:0;
}
.nav-head-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.nav-logo{font-size:13px;font-weight:800;color:var(--accent);letter-spacing:-0.3px}
.nav-project{font-size:10px;color:var(--text-muted);margin-top:2px}
.nav-add-btn{
  display:flex;align-items:center;gap:5px;
  padding:5px 10px;border-radius:var(--r-sm);
  background:var(--accent);color:#fff;border:none;
  font-size:11px;font-weight:700;cursor:pointer;
  transition:background .15s;white-space:nowrap;
}
.nav-add-btn:hover{background:var(--accent-hover)}

/* ê²€ìƒ‰ */
.nav-search{
  position:relative;margin-bottom:0;
}
.nav-search input{
  width:100%;background:var(--surface-2);border:1px solid var(--border);
  border-radius:var(--r-sm);color:var(--text-primary);
  padding:7px 10px 7px 28px;font-size:12px;font-family:var(--font);
  outline:none;transition:border .15s;
}
.nav-search input:focus{border-color:var(--accent)}
.nav-search input::placeholder{color:var(--text-muted)}
.nav-search-icon{position:absolute;left:9px;top:50%;transform:translateY(-50%);font-size:11px;color:var(--text-muted)}

/* ëª©ë¡ */
.nav-list{flex:1;overflow-y:auto;padding:8px 8px}
.nav-list::-webkit-scrollbar{width:3px}
.nav-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

/* í•˜ë‹¨ ì¼ê´„ìˆ˜ì • ë²„íŠ¼ */
.nav-foot{
  padding:12px;border-top:1px solid var(--border);flex-shrink:0;
}
.nav-bulk-btn{
  width:100%;padding:9px 0;border-radius:var(--r-sm);
  background:linear-gradient(135deg,#3a1f6e,#1a3a6e);
  border:1px solid rgba(79,142,247,.3);
  color:#c4b5fd;font-size:12px;font-weight:700;
  cursor:pointer;font-family:var(--font);
  display:flex;align-items:center;justify-content:center;gap:6px;
  transition:all .2s;
}
.nav-bulk-btn:hover{background:linear-gradient(135deg,#4a2f8e,#2a4a8e);color:#e0d4ff;border-color:rgba(79,142,247,.6);}

/* ì¼ê´„ìˆ˜ì • ëª¨ë‹¬ */
.bulk-modal-overlay{
  position:fixed;inset:0;z-index:600;
  background:rgba(7,9,18,.8);backdrop-filter:blur(6px);
  display:flex;align-items:center;justify-content:center;
}
.bulk-modal{
  background:#131722;border:1px solid #2e3350;border-radius:16px;
  width:680px;max-height:85vh;display:flex;flex-direction:column;
  box-shadow:0 32px 80px rgba(0,0,0,.7);
}
.bulk-modal-head{
  padding:24px 28px 20px;border-bottom:1px solid #2e3350;flex-shrink:0;
}
.bulk-modal-title{font-size:16px;font-weight:800;color:#e8ecf4;margin-bottom:4px;}
.bulk-modal-sub{font-size:12px;color:#505878;}
.bulk-modal-body{padding:20px 28px;flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:14px;}
.bulk-scope-label{font-size:11px;font-weight:600;color:#8892b0;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;}
.bulk-scope-list{display:flex;flex-direction:column;gap:4px;max-height:160px;overflow-y:auto;background:#0b0e18;border:1px solid #2e3350;border-radius:8px;padding:8px;}
.bulk-scope-item{display:flex;align-items:center;gap:8px;padding:5px 8px;border-radius:4px;cursor:pointer;}
.bulk-scope-item:hover{background:rgba(255,255,255,.04);}
.bulk-scope-item input[type=checkbox]{accent-color:#4f8ef7;width:13px;height:13px;}
.bulk-scope-item label{font-size:12px;color:#c8d0e0;cursor:pointer;flex:1;}
.bulk-scope-item .scope-id{font-size:10px;color:#505878;font-family:monospace;}
.bulk-prompt-label{font-size:11px;font-weight:600;color:#8892b0;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;}
.bulk-prompt-box{
  width:100%;box-sizing:border-box;height:90px;
  background:#0f1117;border:1px solid #2e3350;border-radius:8px;
  color:#e8ecf4;font-size:13px;font-family:Pretendard,sans-serif;
  padding:12px;resize:vertical;outline:none;transition:border .15s;
}
.bulk-prompt-box:focus{border-color:#4f8ef7;}
.bulk-modal-foot{padding:16px 28px;border-top:1px solid #2e3350;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.bulk-progress{font-size:12px;color:#505878;}
.bulk-progress strong{color:#4f8ef7;}
.bulk-actions{display:flex;gap:8px;}
.bulk-cancel-btn{padding:8px 18px;border-radius:6px;background:#1e2235;border:1px solid #2e3350;color:#8892b0;cursor:pointer;font-size:13px;font-family:var(--font);}
.bulk-run-btn{padding:8px 22px;border-radius:6px;background:linear-gradient(135deg,#4f8ef7,#7c3aed);border:none;color:#fff;cursor:pointer;font-size:13px;font-weight:700;font-family:var(--font);}
.bulk-run-btn:disabled{opacity:.4;cursor:not-allowed;}
.bulk-log{background:#0b0e18;border:1px solid #2e3350;border-radius:8px;padding:10px 12px;font-size:11px;font-family:monospace;max-height:120px;overflow-y:auto;display:none;}
.bulk-log-line{padding:2px 0;color:#505878;}
.bulk-log-line.ok{color:#3ecf8e;}
.bulk-log-line.err{color:#f04b4b;}
.bulk-log-line.ing{color:#4f8ef7;}

/* ê·¸ë£¹ */
.nav-group{margin-bottom:4px}
.nav-group-label{
  display:flex;align-items:center;justify-content:space-between;
  padding:5px 8px;font-size:10px;font-weight:700;
  color:var(--text-muted);letter-spacing:.8px;text-transform:uppercase;
  cursor:pointer;border-radius:var(--r-sm);user-select:none;
}
.nav-group-label:hover{background:var(--surface-2)}
.nav-group-arrow{transition:transform .2s}
.nav-group-arrow.collapsed{transform:rotate(-90deg)}
.nav-group-children{padding-left:0}

/* í˜ì´ì§€ ì•„ì´í…œ */
.nav-item{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:var(--r-sm);
  cursor:pointer;transition:all .15s;
  position:relative;
  user-select:none;
}
.nav-item:hover{background:var(--surface-2)}
.nav-item.active{background:var(--accent-dim);border-left:2px solid var(--accent);padding-left:8px}
.nav-item.drag-over-top{border-top:2px solid var(--accent)!important}
.nav-item.drag-over-bottom{border-bottom:2px solid var(--accent)!important}
.nav-item.dragging{opacity:.35;background:var(--surface-3)}
.drag-handle{
  font-size:11px;color:var(--text-muted);cursor:grab;
  opacity:0;transition:opacity .15s;flex-shrink:0;padding:0 2px;
  line-height:1;
}
.nav-item:hover .drag-handle{opacity:1}
.drag-handle:active{cursor:grabbing}
.nav-item-icon{font-size:13px;flex-shrink:0}
.nav-item-info{flex:1;min-width:0}
.nav-item-name{font-size:12px;font-weight:500;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-item.active .nav-item-name{color:var(--text-primary);font-weight:600}
.nav-item-id{font-size:10px;color:var(--text-muted);font-family:monospace}
.nav-item-type{
  font-size:9px;font-weight:700;padding:1px 5px;border-radius:3px;flex-shrink:0;
}
.type-screen{background:rgba(79,142,247,.15);color:var(--accent)}
.type-popup{background:rgba(168,85,247,.15);color:var(--purple)}
.type-webview{background:rgba(62,207,142,.15);color:var(--success)}

/* â”€â”€ ê°€ìš´ë° ìº”ë²„ìŠ¤ â”€â”€ */
.canvas-area{
  flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;
}

/* ìƒë‹¨ íˆ´ë°” */
.canvas-toolbar{
  height:var(--topbar-h);
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;flex-shrink:0;gap:12px;
}
.toolbar-left{display:flex;align-items:center;gap:10px;min-width:0}
.page-title-bar{
  display:flex;align-items:center;gap:8px;min-width:0;
}
.page-type-badge{
  padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700;flex-shrink:0;
}
.page-name-edit{
  font-size:14px;font-weight:700;color:var(--text-primary);
  background:none;border:none;outline:none;
  cursor:pointer;min-width:0;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.page-name-edit:focus{
  background:var(--surface-2);border-bottom:1px solid var(--accent);
  padding:0 4px;border-radius:3px 3px 0 0;
}

.toolbar-meta{display:flex;align-items:center;gap:6px;flex-shrink:0}
.meta-chip{
  display:flex;align-items:center;gap:4px;
  padding:4px 10px;border-radius:20px;
  background:var(--surface-2);border:1px solid var(--border);
  font-size:11px;color:var(--text-secondary);
  cursor:pointer;transition:all .15s;
}
.meta-chip:hover{border-color:var(--accent);color:var(--text-primary)}
.meta-chip input{
  background:none;border:none;outline:none;
  color:var(--text-primary);font-size:11px;
  font-family:var(--font);width:120px;
}
.meta-chip-label{color:var(--text-muted);font-size:10px}

.toolbar-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.toolbar-btn{
  display:flex;align-items:center;gap:5px;
  padding:6px 12px;border-radius:var(--r-sm);
  font-size:12px;font-weight:600;cursor:pointer;
  border:none;font-family:var(--font);transition:all .15s;
}
.btn-ghost{background:var(--surface-2);color:var(--text-secondary);border:1px solid var(--border)}
.btn-ghost:hover{color:var(--text-primary);border-color:var(--accent)}
.btn-danger-ghost{background:var(--surface-2);color:var(--danger);border:1px solid var(--border)}
.btn-danger-ghost:hover{background:rgba(240,75,75,.1);border-color:var(--danger)}
.btn-primary-sm{background:var(--accent);color:#fff}
.btn-primary-sm:hover{background:var(--accent-hover)}

/* íˆìŠ¤í† ë¦¬ ì¹´ë“œ */
.hcard{
  background:var(--surface-2);border:1px solid var(--border);
  border-radius:var(--r);padding:12px 14px;
  display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
}
.hcard.current{border-color:var(--accent);background:var(--accent-dim)}
.hcard-left{flex:1;min-width:0}
.hcard-ver{font-size:11px;font-weight:700;color:var(--accent);font-family:monospace;margin-bottom:4px}
.hcard.current .hcard-ver::after{content:' Â· í˜„ì¬';color:var(--success)}
.hcard-desc{font-size:12px;color:var(--text-secondary);line-height:1.5}
.hcard-meta{font-size:10px;color:var(--text-muted);margin-top:4px}
.hcard-restore{
  padding:5px 12px;border-radius:var(--r-sm);
  background:var(--surface-3);border:1px solid var(--border);
  color:var(--text-secondary);font-size:11px;font-weight:600;
  cursor:pointer;white-space:nowrap;transition:all .15s;flex-shrink:0;
  font-family:var(--font);
}
.hcard-restore:hover{color:var(--accent);border-color:var(--accent)}
.hcard.current .hcard-restore{opacity:.3;cursor:not-allowed}
.history-empty{text-align:center;color:var(--text-muted);font-size:12px;padding:24px}

/* í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë°” (prev/next) */
.page-nav-bar{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 20px;
  background:var(--surface);
  border-bottom:1px solid var(--border-2);
  flex-shrink:0;
}
.page-nav-btn{
  display:flex;align-items:center;gap:6px;
  padding:5px 12px;border-radius:var(--r-sm);
  background:var(--surface-2);border:1px solid var(--border);
  color:var(--text-secondary);font-size:12px;cursor:pointer;
  transition:all .15s;
}
.page-nav-btn:hover{color:var(--text-primary);border-color:var(--accent)}
.page-nav-btn:disabled{opacity:.3;cursor:not-allowed}
.page-counter{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:6px}
.page-counter strong{color:var(--text-primary)}
.page-dots{display:flex;gap:4px;align-items:center}
.page-dot{width:6px;height:6px;border-radius:50%;background:var(--border);transition:all .15s;cursor:pointer}
.page-dot.active{background:var(--accent);width:18px;border-radius:3px}

/* í”„ë ˆì„ ë·°ì–´ */
.frame-outer{
  flex:1;overflow:auto;
  display:flex;align-items:flex-start;justify-content:center;
  padding:24px;background:var(--bg);
  position:relative;
}
.frame-outer::-webkit-scrollbar{width:6px;height:6px}
.frame-outer::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.frame-wrapper{
  background:#0f1117;border-radius:10px;
  box-shadow:0 0 0 1px rgba(255,255,255,.06), 0 20px 60px rgba(0,0,0,.5);
  overflow:hidden;width:100%;max-width:1100px;min-height:600px;
  position:relative;
}
.frame-wrapper iframe{
  width:100%;min-height:600px;border:none;display:block;
}
.frame-empty{
  width:100%;max-width:1100px;min-height:600px;
  background:var(--surface);border-radius:10px;
  border:2px dashed var(--border);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:0;cursor:pointer;transition:border-color .2s, background .2s;
  position:relative;overflow:hidden;
}
.frame-empty:hover{border-color:var(--accent);background:rgba(79,142,247,.03)}
.frame-empty-icon{font-size:44px;opacity:.25;margin-bottom:12px}
.frame-empty-title{font-size:15px;font-weight:700;color:var(--text-secondary);margin-bottom:6px}
.frame-empty-sub{font-size:12px;color:var(--text-muted);margin-bottom:20px}
.frame-empty-cta{
  display:flex;align-items:center;gap:7px;
  padding:10px 22px;border-radius:var(--r);
  background:var(--accent);color:#fff;font-size:13px;font-weight:700;
  border:none;cursor:pointer;font-family:var(--font);
  transition:background .15s;
}
.frame-empty-cta:hover{background:var(--accent-hover)}

/* AI ìƒì„± ì…ë ¥ì°½ ì˜¤ë²„ë ˆì´ */
.ai-input-overlay{
  position:absolute;inset:0;
  background:rgba(11,14,24,.92);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:16px;padding:40px;
  backdrop-filter:blur(4px);
  animation:fadeIn .2s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.ai-input-title{font-size:15px;font-weight:700;color:var(--text-primary);display:flex;align-items:center;gap:8px}
.ai-input-box{
  width:100%;max-width:620px;
  background:var(--surface-2);border:1px solid var(--accent);
  border-radius:var(--r);padding:14px 16px;
  color:var(--text-primary);font-size:14px;font-family:var(--font);
  outline:none;resize:none;height:110px;line-height:1.6;
  transition:border-color .15s;
}
.ai-input-box:focus{border-color:var(--accent-hover)}
.ai-input-box::placeholder{color:var(--text-muted)}
.ai-input-actions{display:flex;gap:8px;width:100%;max-width:620px;justify-content:flex-end}
.ai-input-cancel{background:var(--surface-3);border:1px solid var(--border);color:var(--text-secondary);border-radius:var(--r-sm);padding:8px 18px;font-size:13px;cursor:pointer;font-family:var(--font)}
.ai-input-submit{
  background:var(--accent);color:#fff;border:none;border-radius:var(--r-sm);
  padding:8px 22px;font-size:13px;font-weight:700;cursor:pointer;font-family:var(--font);
  display:flex;align-items:center;gap:6px;transition:background .15s;
}
.ai-input-submit:hover{background:var(--accent-hover)}
.ai-input-submit:disabled{opacity:.5;cursor:not-allowed}
.ai-hint{font-size:11px;color:var(--text-muted);width:100%;max-width:620px;line-height:1.6}

/* ìƒì„± ì¤‘ ë¡œë”© */
.ai-generating{
  position:absolute;inset:0;
  background:rgba(11,14,24,.92);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:16px;
}
.ai-gen-spinner{
  width:36px;height:36px;border-radius:50%;
  border:3px solid var(--border);border-top-color:var(--accent);
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.ai-gen-text{font-size:13px;color:var(--text-secondary);animation:pulse 1.5s ease infinite}
@keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}
.ai-gen-prompt{font-size:11px;color:var(--text-muted);max-width:300px;text-align:center;line-height:1.6}

/* ìƒì„±ëœ í™”ë©´ ìœ„ í”Œë¡œíŒ… ìˆ˜ì • ë²„íŠ¼ */
.frame-edit-bar{
  position:absolute;top:36px;right:36px;
  display:flex;gap:6px;z-index:9999;
  opacity:0;transition:opacity .2s;
  pointer-events:none;
}
.frame-outer:hover .frame-edit-bar{opacity:1;pointer-events:all}
.fedit-btn{
  display:flex;align-items:center;gap:5px;
  padding:6px 12px;border-radius:var(--r-sm);
  font-size:12px;font-weight:600;cursor:pointer;
  border:none;font-family:var(--font);backdrop-filter:blur(8px);
  transition:all .15s;pointer-events:all;
}
.fedit-ai{background:rgba(79,142,247,.9);color:#fff}
.fedit-ai:hover{background:var(--accent)}
.fedit-regen{background:rgba(34,38,58,.9);color:var(--text-secondary);border:1px solid var(--border)}
.fedit-regen:hover{color:var(--text-primary);border-color:var(--accent)}

/* ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ */
.ctx-menu{
  position:fixed;z-index:8000;
  background:#1a1d27;border:1px solid #2e3350;border-radius:8px;
  padding:4px 0;min-width:170px;
  box-shadow:0 8px 32px rgba(0,0,0,.6);
  display:none;
}
.ctx-menu.show{display:block;}
.ctx-item{
  padding:8px 14px;font-size:12px;color:#c8d0e0;cursor:pointer;
  display:flex;align-items:center;gap:8px;
}
.ctx-item:hover{background:rgba(79,142,247,.12);color:#e8ecf4;}
.ctx-sep{height:1px;background:#2e3350;margin:4px 0;}
/* ê·¸ë£¹ ì¸ë¼ì¸ í¸ì§‘ */
.nav-group-name-input{
  background:transparent;border:none;border-bottom:1px solid var(--accent);
  color:var(--text-primary);font-size:12px;font-weight:700;
  font-family:var(--font);outline:none;width:80%;
}

/* â”€â”€ ìš°ì¸¡ ì •ì±… íŒ¨ë“œ â”€â”€ */
.policy-pad{
  width:var(--pad-width);
  background:var(--surface);
  border-left:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;overflow:hidden;
}
.pad-head{
  padding:14px 14px 10px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;
}
.pad-head-info{display:flex;align-items:center;gap:8px}
.pad-head-title{font-size:12px;font-weight:700}
.pad-screen-id{font-size:10px;color:var(--text-muted);font-family:monospace}
.pad-add{
  width:26px;height:26px;border-radius:var(--r-sm);
  background:var(--accent);color:#fff;border:none;
  font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:background .15s;
}
.pad-add:hover{background:var(--accent-hover)}

.pad-filter{
  display:flex;gap:3px;padding:8px 10px;
  border-bottom:1px solid var(--border);flex-wrap:wrap;flex-shrink:0;
}
.fchip{
  padding:3px 7px;border-radius:20px;font-size:10px;font-weight:600;
  cursor:pointer;border:1px solid transparent;color:var(--text-muted);
  background:transparent;transition:all .15s;
}
.fchip:hover{color:var(--text-secondary)}
.fchip.on{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

.pad-list{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:7px}
.pad-list::-webkit-scrollbar{width:3px}
.pad-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

/* ë…¸íŠ¸ ì¹´ë“œ */
.ncard{
  background:var(--surface-2);border:1px solid var(--border);
  border-radius:var(--r);padding:10px;transition:border-color .15s;
}
.ncard:hover{border-color:#3a4060}
.ncard.resolved{opacity:.4}
.ncard-top{display:flex;align-items:flex-start;justify-content:space-between;gap:6px;margin-bottom:6px}
.ntag{
  display:inline-block;padding:2px 7px;border-radius:20px;
  font-size:10px;font-weight:700;flex-shrink:0;
}
.t-backend {background:rgba(79,142,247,.15);color:#7eb3ff}
.t-popup   {background:rgba(168,85,247,.15);color:#c084fc}
.t-auth    {background:rgba(245,158,11,.15);color:#fbbf24}
.t-security{background:rgba(240,75,75,.15);color:#f87171}
.t-ui      {background:rgba(62,207,142,.15);color:#34d399}
.t-pending {background:rgba(148,163,184,.15);color:#94a3b8}
.ncard-acts{display:flex;gap:3px;opacity:0;transition:opacity .15s}
.ncard:hover .ncard-acts{opacity:1}
.nact{
  width:19px;height:19px;border-radius:3px;
  background:var(--surface-3);border:1px solid var(--border);
  cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;
  color:var(--text-muted);transition:all .15s;
}
.nact:hover{color:var(--text-primary);border-color:var(--accent)}
.nbody{font-size:12px;color:var(--text-secondary);line-height:1.6;white-space:pre-wrap;word-break:break-all}
.nfoot{display:flex;align-items:center;justify-content:space-between;margin-top:7px}
.nmeta{font-size:10px;color:var(--text-muted)}
.nresolve{
  font-size:10px;color:var(--text-muted);background:none;
  border:1px solid var(--border);border-radius:3px;padding:2px 7px;cursor:pointer;transition:all .15s;
}
.nresolve:hover{color:var(--success);border-color:var(--success)}
.nresolve.done{color:var(--success);border-color:var(--success);background:rgba(62,207,142,.08)}

/* ì…ë ¥ í¼ */
.pad-compose{
  border-top:1px solid var(--border);padding:10px;
  display:none;flex-direction:column;gap:7px;flex-shrink:0;
}
.pad-compose.open{display:flex}
.ctags{display:flex;gap:4px;flex-wrap:wrap}
.ctag{
  padding:3px 8px;border-radius:20px;font-size:10px;font-weight:600;
  cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--text-muted);
  transition:all .15s;
}
.ctag.sel-backend {background:rgba(79,142,247,.15);color:#7eb3ff;border-color:transparent}
.ctag.sel-popup   {background:rgba(168,85,247,.15);color:#c084fc;border-color:transparent}
.ctag.sel-auth    {background:rgba(245,158,11,.15);color:#fbbf24;border-color:transparent}
.ctag.sel-security{background:rgba(240,75,75,.15);color:#f87171;border-color:transparent}
.ctag.sel-ui      {background:rgba(62,207,142,.15);color:#34d399;border-color:transparent}
.ctag.sel-pending {background:rgba(148,163,184,.15);color:#94a3b8;border-color:transparent}
.ctextarea{
  width:100%;background:var(--surface-3);border:1px solid var(--border);
  border-radius:var(--r-sm);color:var(--text-primary);font-size:12px;
  font-family:var(--font);padding:7px 9px;resize:none;height:68px;outline:none;
}
.ctextarea:focus{border-color:var(--accent)}
.ctextarea::placeholder{color:var(--text-muted)}
.cfoot{display:flex;justify-content:flex-end;gap:5px}
.ccancel{background:none;border:1px solid var(--border);color:var(--text-muted);border-radius:var(--r-sm);padding:4px 11px;font-size:11px;cursor:pointer}
.csubmit{background:var(--accent);color:#fff;border:none;border-radius:var(--r-sm);padding:4px 13px;font-size:11px;font-weight:700;cursor:pointer}

.pad-empty{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:8px;color:var(--text-muted);font-size:12px;padding:20px;text-align:center;
}
.pad-empty-icon{font-size:28px;opacity:.3}

/* ============================================================
   ìƒˆ í˜ì´ì§€ ì¶”ê°€ ëª¨ë‹¬
============================================================ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:flex;align-items:center;justify-content:center;z-index:200;
  backdrop-filter:blur(6px);
}
.modal-box{
  background:var(--surface);border:1px solid var(--border);
  border-radius:14px;width:480px;padding:28px;
}
.modal-title{font-size:16px;font-weight:800;margin-bottom:20px}
.mform-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
.mform-label{font-size:11px;color:var(--text-secondary);font-weight:600}
.mform-input{
  background:var(--surface-2);border:1px solid var(--border);
  border-radius:var(--r-sm);color:var(--text-primary);
  padding:9px 12px;font-size:13px;font-family:var(--font);outline:none;
  transition:border .15s;
}
.mform-input:focus{border-color:var(--accent)}
.mform-input::placeholder{color:var(--text-muted)}
.mtype-row{display:flex;gap:8px}
.mtype-btn{
  flex:1;padding:10px;border-radius:var(--r);
  border:1px solid var(--border);background:var(--surface-2);
  color:var(--text-secondary);cursor:pointer;font-size:12px;font-weight:600;
  font-family:var(--font);text-align:center;transition:all .15s;
}
.mtype-btn:hover{border-color:var(--accent);color:var(--text-primary)}
.mtype-btn.sel{border-color:var(--accent);background:var(--accent-dim);color:var(--accent)}
.modal-footer{display:flex;justify-content:flex-end;gap:8px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}
.mcancel{background:var(--surface-2);border:1px solid var(--border);color:var(--text-secondary);border-radius:var(--r-sm);padding:8px 18px;font-size:13px;cursor:pointer;font-family:var(--font)}
.msubmit{background:var(--accent);color:#fff;border:none;border-radius:var(--r-sm);padding:8px 20px;font-size:13px;font-weight:700;cursor:pointer;font-family:var(--font)}
.msubmit:hover{background:var(--accent-hover)}
.hidden{display:none!important}

/* ============================================================
   ì„ë² ë“œ í™”ë©´ ìŠ¤íƒ€ì¼ (ì–´ë“œë¯¼ ë‚´ë¶€)
============================================================ */
/* ì•„ë˜ .emb-* í´ë˜ìŠ¤ë“¤ì€ ìº”ë²„ìŠ¤ ì•ˆ ì–´ë“œë¯¼ í™”ë©´ìš© */
.emb-wrap{background:#0f1117;min-height:600px;font-family:var(--font);color:#e8ecf4;font-size:13px}
.emb-topbar{height:52px;background:#1a1d27;border-bottom:1px solid #2e3350;display:flex;align-items:center;justify-content:space-between;padding:0 24px}
.emb-breadcrumb{display:flex;align-items:center;gap:6px;color:#8892b0;font-size:12px}
.emb-breadcrumb span{color:#e8ecf4;font-weight:500}
.emb-topbadge{background:rgba(79,142,247,.15);color:#4f8ef7;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600}
.emb-body{padding:24px}
.emb-ph{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px}
.emb-ptitle{font-size:18px;font-weight:700}
.emb-psub{font-size:12px;color:#8892b0;margin-top:3px}
.emb-sid{font-size:10px;color:#505878;background:#22263a;padding:2px 7px;border-radius:3px;font-family:monospace;margin-top:4px;display:inline-block}
.emb-filter{background:#1a1d27;border:1px solid #2e3350;border-radius:8px;padding:16px;margin-bottom:16px;display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
.emb-fg{display:flex;flex-direction:column;gap:5px}
.emb-flabel{font-size:11px;color:#8892b0;font-weight:500}
.emb-input{background:#22263a;border:1px solid #2e3350;border-radius:4px;color:#e8ecf4;padding:7px 10px;font-size:12px;font-family:var(--font);outline:none;min-width:130px}
.emb-select{background:#22263a;border:1px solid #2e3350;border-radius:4px;color:#e8ecf4;padding:7px 10px;font-size:12px;font-family:var(--font);outline:none}
.emb-btn{padding:7px 14px;border-radius:4px;font-size:12px;font-weight:600;cursor:pointer;border:none;font-family:var(--font)}
.emb-btn-p{background:#4f8ef7;color:#fff}
.emb-btn-s{background:#22263a;color:#8892b0;border:1px solid #2e3350}
.emb-btn-do{background:transparent;color:#f04b4b;border:1px solid #f04b4b}
.emb-btn-sm{padding:4px 10px;font-size:11px}
.emb-th-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.emb-rc{font-size:12px;color:#8892b0}
.emb-rc strong{color:#e8ecf4}
.emb-table-wrap{background:#1a1d27;border:1px solid #2e3350;border-radius:8px;overflow:hidden}
.emb-table{width:100%;border-collapse:collapse}
.emb-table thead tr{background:#22263a;border-bottom:1px solid #2e3350}
.emb-table th{padding:10px 13px;text-align:left;font-size:11px;font-weight:600;color:#505878;letter-spacing:.4px;text-transform:uppercase;white-space:nowrap}
.emb-table td{padding:11px 13px;border-bottom:1px solid #2e3350;font-size:13px;vertical-align:middle}
.emb-table tbody tr:last-child td{border-bottom:none}
.emb-table tbody tr:hover{background:rgba(255,255,255,.015)}
.emb-link{color:#4f8ef7;cursor:pointer}
.emb-link:hover{color:#6fa3ff;text-decoration:underline}
.emb-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}
.emb-dot{width:5px;height:5px;border-radius:50%}
.emb-badge-a{background:rgba(62,207,142,.12);color:#3ecf8e}.emb-badge-a .emb-dot{background:#3ecf8e}
.emb-badge-i{background:rgba(240,75,75,.12);color:#f04b4b}.emb-badge-i .emb-dot{background:#f04b4b}
.emb-badge-p{background:rgba(245,158,11,.12);color:#f59e0b}.emb-badge-p .emb-dot{background:#f59e0b}
.emb-role{display:inline-block;padding:2px 7px;border-radius:3px;font-size:11px;font-weight:500}
.emb-role-admin{background:rgba(79,142,247,.15);color:#4f8ef7}
.emb-role-mgr{background:rgba(245,158,11,.12);color:#f59e0b}
.emb-role-view{background:rgba(136,146,176,.12);color:#8892b0}
.emb-page{display:flex;align-items:center;justify-content:center;gap:3px;padding:16px 0 4px}
.emb-pgbtn{width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:4px;border:1px solid #2e3350;background:#22263a;color:#8892b0;cursor:pointer;font-size:12px}
.emb-pgbtn.act{background:#4f8ef7;color:#fff;border-color:#4f8ef7}

/* íŒì—… í™”ë©´ìš© */
.emb-popup-bg{background:#0f1117;min-height:600px;display:flex;align-items:center;justify-content:center;padding:30px;font-family:var(--font)}
.emb-popup-overlay{position:absolute;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center}
.emb-modal{background:#1a1d27;border:1px solid #2e3350;border-radius:12px;width:500px;padding:26px}
.emb-modal-title{font-size:15px;font-weight:700;color:#e8ecf4;margin-bottom:18px}
.emb-form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
.emb-form-g{display:flex;flex-direction:column;gap:5px}
.emb-form-g.full{grid-column:1/-1}
.emb-form-label{font-size:11px;color:#8892b0;font-weight:500}
.emb-form-val{background:#22263a;border:1px solid #2e3350;border-radius:4px;padding:7px 10px;font-size:13px;color:#505878}
.emb-mfooter{display:flex;justify-content:flex-end;gap:7px;margin-top:20px;padding-top:16px;border-top:1px solid #2e3350}

/* ê¶Œí•œê´€ë¦¬ í™”ë©´ */
.emb-role-table{width:100%;border-collapse:collapse}
.emb-role-table th{padding:9px 13px;text-align:left;font-size:11px;font-weight:600;color:#505878;background:#22263a;border-bottom:1px solid #2e3350;text-transform:uppercase}
.emb-role-table td{padding:10px 13px;border-bottom:1px solid #2e3350;font-size:13px}
.emb-role-table tbody tr:last-child td{border-bottom:none}
.emb-toggle{
  position:relative;display:inline-flex;align-items:center;
  width:36px;height:20px;cursor:pointer;
}
.emb-toggle input{opacity:0;width:0;height:0}
.emb-slider{
  position:absolute;inset:0;background:#2e3350;border-radius:20px;transition:.2s;
}
.emb-slider:before{
  content:'';position:absolute;width:14px;height:14px;border-radius:50%;
  background:#fff;bottom:3px;left:3px;transition:.2s;
}
.emb-toggle input:checked+.emb-slider{background:#4f8ef7}
.emb-toggle input:checked+.emb-slider:before{transform:translateX(16px)}
</style>

<!-- Claude ê²Œì‹œ í™˜ê²½ ìŠ¤íƒ€ì¼ ë -->
</head>
<body>

<!-- ==============================
     ê¸°íšì„œ ë¦¬ìŠ¤íŠ¸ í™”ë©´
============================== -->
<div id="projectListView" style="display:none;">
  <div class="pl-wrap">
    <div class="pl-header">
      <div>
        <div class="pl-logo">ğŸ“ Planify</div>
        <div class="pl-subtitle">ê¸°íšì„œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”</div>
      </div>
      <button class="pl-new-btn" onclick="createNewProject()">+ ìƒˆ ê¸°íšì„œ</button>
    </div>
    <div class="pl-grid" id="projectGrid"></div>
  </div>
</div>

<!-- ê¸°íšì„œ ë§Œë“¤ê¸° ëª¨ë‹¬ -->
<div class="modal-overlay hidden" id="newProjectModal">
  <div class="modal-box" style="max-width:400px;">
    <div class="modal-title" id="newProjectModalTitle">ìƒˆ ê¸°íšì„œ ë§Œë“¤ê¸°</div>
    <div class="mform-group">
      <div class="mform-label">ê¸°íšì„œ ì´ë¦„ *</div>
      <input class="mform-input" id="newProjectName" placeholder="ì˜ˆ: ì‡¼í•‘ëª° ì–´ë“œë¯¼ v1"
        onkeydown="if(event.key==='Enter') confirmNewProject()">
    </div>
    <div class="mform-group">
      <div class="mform-label">ì„¤ëª… (ì„ íƒ)</div>
      <input class="mform-input" id="newProjectDesc" placeholder="ì˜ˆ: 2025 ë¦¬ë‰´ì–¼ ê¸°íš">
    </div>
    <div class="modal-footer">
      <button class="mcancel" onclick="closeNewProjectModal()">ì·¨ì†Œ</button>
      <button class="msubmit" id="newProjectSubmitBtn" onclick="confirmNewProject()">ë§Œë“¤ê¸°</button>
    </div>
  </div>
</div>

<style>
/* â”€â”€ ê¸°íšì„œ ë¦¬ìŠ¤íŠ¸ â”€â”€ */
.pl-wrap{
  min-height:100vh;
  background:#08090f;
  padding:48px 40px;
  font-family:var(--font,'Pretendard',sans-serif);
}
.pl-header{
  display:flex;align-items:flex-end;justify-content:space-between;
  margin-bottom:36px;
}
.pl-logo{
  font-size:20px;font-weight:800;
  background:linear-gradient(135deg,#5b7ff7,#a78bfa);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:6px;
}
.pl-subtitle{font-size:13px;color:#505878;}
.pl-new-btn{
  padding:10px 20px;border-radius:8px;
  background:linear-gradient(135deg,#5b7ff7,#7c5cf7);
  border:none;color:#fff;font-size:13px;font-weight:700;
  font-family:var(--font,'Pretendard',sans-serif);cursor:pointer;
  box-shadow:0 4px 16px rgba(91,127,247,.3);transition:all .2s;
}
.pl-new-btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(91,127,247,.5);}
.pl-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:16px;
}
.pl-card{
  background:#10121c;border:1px solid #1e2235;border-radius:14px;
  padding:22px;cursor:pointer;transition:all .25s;
  position:relative;overflow:hidden;
}
.pl-card:hover{border-color:rgba(91,127,247,.4);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.4);}
.pl-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,#5b7ff7,#a78bfa);
  opacity:0;transition:opacity .25s;
}
.pl-card:hover::before{opacity:1;}
.pl-card-icon{font-size:28px;margin-bottom:14px;}
.pl-card-name{
  font-size:15px;font-weight:700;color:#e8ecf4;
  margin-bottom:4px;line-height:1.3;
}
.pl-card-desc{font-size:12px;color:#505878;margin-bottom:14px;min-height:16px;}
.pl-card-meta{
  display:flex;align-items:center;justify-content:space-between;
}
.pl-card-pages{
  font-size:11px;color:#3b4268;
  background:#0d0f1a;padding:3px 8px;border-radius:4px;
}
.pl-card-date{font-size:11px;color:#3b4268;}
.pl-card-actions{
  position:absolute;top:12px;right:12px;
  display:flex;gap:4px;opacity:0;transition:opacity .2s;
}
.pl-card:hover .pl-card-actions{opacity:1;}
.pl-card-action-btn{
  width:26px;height:26px;border-radius:6px;
  background:#1e2235;border:1px solid #2e3350;
  color:#6b7590;font-size:12px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.pl-card-action-btn:hover{background:#2e3350;color:#e8ecf4;}
.pl-card-action-btn.danger:hover{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.3);color:#f87171;}
/* ë¹ˆ ìƒíƒœ */
.pl-empty{
  grid-column:1/-1;
  text-align:center;padding:80px 20px;
  color:#3b4268;
}
.pl-empty-icon{font-size:48px;margin-bottom:16px;opacity:.4;}
.pl-empty-text{font-size:14px;}
</style>

<div class="shell">

  <!-- ==============================
       ì¢Œì¸¡ í˜ì´ì§€ ëª©ë¡ íŒ¨ë„
  ============================== -->
  <nav class="nav-panel">
    <div class="nav-head">
      <div class="nav-head-top">
        <div style="display:flex;align-items:center;gap:6px;min-width:0;flex:1;">
          <button onclick="goToProjectList()" title="ê¸°íšì„œ ëª©ë¡ìœ¼ë¡œ" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:15px;padding:2px 4px;flex-shrink:0;">â€¹</button>
          <div style="min-width:0;">
            <div class="nav-logo">ğŸ“ ê¸°íšì„œ</div>
            <div class="nav-project" id="currentProjectName" style="cursor:pointer;" ondblclick="renameCurrentProject()">ì¦ê¶Œì‚¬ ì–´ë“œë¯¼</div>
          </div>
        </div>
        <div style="display:flex;gap:4px;flex-shrink:0;">
          <button class="nav-add-btn" onclick="openAddModal()">+ í˜ì´ì§€</button>
          <button class="nav-add-btn" onclick="addNewGroup()" style="background:var(--surface-2);color:var(--text-secondary);border:1px solid var(--border);">+ ê·¸ë£¹</button>
        </div>
      </div>
      <div class="nav-search">
        <span class="nav-search-icon">ğŸ”</span>
        <input type="text" placeholder="í™”ë©´ ê²€ìƒ‰..." oninput="searchPages(this.value)" id="navSearch">
      </div>
    </div>
    <div class="nav-list" id="navList"></div>
    <div class="nav-foot">
      <button class="nav-bulk-btn" onclick="openBulkModal()">âœ¦ AI ì¼ê´„ ìˆ˜ì •</button>
    </div>
  </nav>

  <!-- ==============================
       ê°€ìš´ë° ìº”ë²„ìŠ¤
  ============================== -->
  <div class="canvas-area">

    <!-- ìƒë‹¨ íˆ´ë°” -->
    <div class="canvas-toolbar">
      <div class="toolbar-left">
        <div class="page-title-bar">
          <span class="page-type-badge type-screen" id="toolbarTypeBadge">í™”ë©´</span>
          <input class="page-name-edit" id="toolbarName" value="ì‚¬ìš©ì ê´€ë¦¬"
            onblur="updateCurrentPageName(this.value)"
            onkeydown="if(event.key==='Enter')this.blur()">
        </div>
      </div>
      <div class="toolbar-meta" id="toolbarMeta">
        <div class="meta-chip" title="í™”ë©´ ID">
          <span class="meta-chip-label">ID</span>
          <input id="metaId" value="ADM-USR-001" onblur="updateMetaField('screenId',this.value)" onkeydown="if(event.key==='Enter')this.blur()">
        </div>
        <div class="meta-chip" title="ê²½ë¡œ">
          <span class="meta-chip-label">ê²½ë¡œ</span>
          <input id="metaPath" value="ì–´ë“œë¯¼ > íšŒì›ê´€ë¦¬ > ì‚¬ìš©ì ê´€ë¦¬" onblur="updateMetaField('path',this.value)" onkeydown="if(event.key==='Enter')this.blur()">
        </div>
      </div>
      <div class="toolbar-right">
        <button class="toolbar-btn btn-ghost" onclick="openHistoryModal()" title="ë²„ì „ íˆìŠ¤í† ë¦¬">ğŸ•“ íˆìŠ¤í† ë¦¬</button>
        <button class="toolbar-btn btn-danger-ghost" onclick="openDeleteConfirm()" title="ì´ í˜ì´ì§€ ì‚­ì œ">ğŸ—‘ ì‚­ì œ</button>
      </div>
    </div>

    <!-- ì´ì „/ë‹¤ìŒ ë„¤ë¹„ -->
    <div class="page-nav-bar">
      <button class="page-nav-btn" id="btnPrev" onclick="goPage(-1)">â† ì´ì „</button>
      <div class="page-counter">
        <strong id="cntCurrent">1</strong>
        <span>/ <span id="cntTotal">1</span></span>
        <div class="page-dots" id="pageDots"></div>
      </div>
      <button class="page-nav-btn" id="btnNext" onclick="goPage(1)">ë‹¤ìŒ â†’</button>
    </div>

    <!-- í”„ë ˆì„ ë·°ì–´ -->
    <div class="frame-outer">
      <div id="frameWrapper"></div>
    </div>

  </div><!-- /canvas-area -->

  <!-- ==============================
       ìš°ì¸¡ ì •ì±… íŒ¨ë“œ
  ============================== -->
  <div class="policy-pad">
    <div class="pad-head">
      <div class="pad-head-info">
        <span>ğŸ“‹</span>
        <div>
          <div class="pad-head-title">ì •ì±… ë©”ëª¨</div>
          <div class="pad-screen-id" id="padScreenId">ADM-USR-001</div>
        </div>
      </div>
      <button class="pad-add" onclick="toggleCompose()" title="ë©”ëª¨ ì¶”ê°€">+</button>
    </div>
    <div class="pad-filter">
      <span class="fchip on"  onclick="filterNotes('all',this)">ì „ì²´</span>
      <span class="fchip" onclick="filterNotes('backend',this)">ë°±ì—”ë“œ</span>
      <span class="fchip" onclick="filterNotes('popup',this)">íŒì—…</span>
      <span class="fchip" onclick="filterNotes('auth',this)">ê¶Œí•œ</span>
      <span class="fchip" onclick="filterNotes('security',this)">ë³´ì•ˆ</span>
      <span class="fchip" onclick="filterNotes('pending',this)">ë¯¸í™•ì •</span>
    </div>
    <div class="pad-list" id="padList"></div>
    <div class="pad-compose" id="padCompose">
      <div class="ctags" id="ctagsRow">
        <button class="ctag" data-tag="backend"  onclick="selTag(this)">ë°±ì—”ë“œ</button>
        <button class="ctag" data-tag="popup"    onclick="selTag(this)">íŒì—…</button>
        <button class="ctag" data-tag="auth"     onclick="selTag(this)">ê¶Œí•œ</button>
        <button class="ctag" data-tag="security" onclick="selTag(this)">ë³´ì•ˆ</button>
        <button class="ctag" data-tag="ui"       onclick="selTag(this)">UI</button>
        <button class="ctag" data-tag="pending"  onclick="selTag(this)">ë¯¸í™•ì •</button>
      </div>
      <textarea class="ctextarea" id="composeText" placeholder="ì •ì±… ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <div class="cfoot">
        <button class="ccancel" onclick="toggleCompose()">ì·¨ì†Œ</button>
        <button class="csubmit" onclick="addNote()">ì¶”ê°€</button>
      </div>
    </div>
  </div>

</div><!-- /shell -->

<!-- ==============================
     ìƒˆ í˜ì´ì§€ ì¶”ê°€ ëª¨ë‹¬
============================== -->
<div class="modal-overlay hidden" id="addModal">
  <div class="modal-box">
    <div class="modal-title">ìƒˆ í˜ì´ì§€ ì¶”ê°€</div>
    <div class="mform-group">
      <div class="mform-label">í™”ë©´ ìœ í˜•</div>
      <div class="mtype-row">
        <button class="mtype-btn sel" data-type="screen" onclick="selModalType(this)">ğŸ–¥ í™”ë©´</button>
        <button class="mtype-btn" data-type="popup" onclick="selModalType(this)">ğŸ’¬ íŒì—…</button>
      </div>
    </div>
    <div class="mform-group">
      <div class="mform-label">í™”ë©´ëª… *</div>
      <input class="mform-input" id="mName" placeholder="ì˜ˆ: ì‚¬ìš©ì ìƒì„¸">
    </div>
    <div class="mform-group">
      <div class="mform-label">í™”ë©´ ID *</div>
      <input class="mform-input" id="mId" placeholder="ì˜ˆ: ADM-USR-002">
    </div>
    <div class="mform-group">
      <div class="mform-label">ê²½ë¡œ</div>
      <input class="mform-input" id="mPath" placeholder="ì˜ˆ: ì–´ë“œë¯¼ > íšŒì›ê´€ë¦¬ > ì‚¬ìš©ì ìƒì„¸">
    </div>
    <div class="mform-group">
      <div class="mform-label">ê·¸ë£¹</div>
      <div style="display:flex;gap:6px;">
        <select class="mform-input" id="mGroupSelect" onchange="onGroupSelectChange(this)" style="flex:1;">
          <option value="">-- ê·¸ë£¹ ì„ íƒ --</option>
        </select>
        <input class="mform-input" id="mGroupInput" placeholder="ì§ì ‘ ì…ë ¥" style="flex:1;">
      </div>
    </div>
    <div class="modal-footer">
      <button class="mcancel" onclick="closeAddModal()">ì·¨ì†Œ</button>
      <button class="msubmit" onclick="confirmAddPage()">ì¶”ê°€</button>
    </div>
  </div>
</div>


// ============================================================
//  í”„ë¡œì íŠ¸(ê¸°íšì„œ) ê´€ë¦¬
// ============================================================
const PROJECTS_KEY = 'planify_projects_v1';
const CURRENT_PROJECT_KEY = 'planify_current_project';

// ê¸°ë³¸ ìƒ˜í”Œ í”„ë¡œì íŠ¸
const DEFAULT_PROJECTS = [
  {
    id: 'proj_1',
    name: 'ì¦ê¶Œì‚¬ ì–´ë“œë¯¼',
    desc: 'ìƒ˜í”Œ ê¸°íšì„œ',
    createdAt: Date.now(),
    _pendingGroups: [],
    pages: [
      {
        id:'p1', type:'screen', name:'ì‚¬ìš©ì ê´€ë¦¬',
        screenId:'ADM-USR-001', path:'ì–´ë“œë¯¼ > íšŒì›ê´€ë¦¬ > ì‚¬ìš©ì ê´€ë¦¬',
        group:'íšŒì›ê´€ë¦¬',
        notes:[
          {id:1,tag:'backend', text:'ì¡°íšŒ ì‹œ ìµœì†Œ 1ì ì´ìƒ. ê³µë°±ë§Œ ì…ë ¥ ì‹œ ì „ì²´ ì¡°íšŒì™€ ë™ì¼ ì²˜ë¦¬',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:2,tag:'backend', text:'ë§ˆì§€ë§‰ ë¡œê·¸ì¸ì€ ë¡œê·¸ í…Œì´ë¸” JOIN. ì—†ìœ¼ë©´ \'-\' í‘œì‹œ',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:3,tag:'backend', text:'í˜ì´ì§€ë‹¹ ê¸°ë³¸ 20ê±´, í´ë¼ì´ì–¸íŠ¸ì—ì„œ 10/20/50/100 ì„ íƒ ê°€ëŠ¥',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:4,tag:'popup',   text:'ê³„ì • ë¹„í™œì„±í™” ì‹œ í™•ì¸ íŒì—…: "í•´ë‹¹ ì‚¬ìš©ìì˜ ê³„ì •ì„ ë¹„í™œì„±í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:5,tag:'auth',    text:'[ì‚¬ìš©ì ë“±ë¡] ë²„íŠ¼ - SUPER ADMIN, ADMIN ê¶Œí•œë§Œ ë…¸ì¶œ',author:'ê¸°íšì',date:'02-26',resolved:false},
        ]
      },
      {
        id:'p2', type:'popup', name:'ì‚¬ìš©ì ìƒì„¸ íŒì—…',
        screenId:'ADM-USR-001-P1', path:'ADM-USR-001 > ì´ë¦„ í´ë¦­',
        group:'íšŒì›ê´€ë¦¬',
        notes:[
          {id:1,tag:'popup', text:'ì´ë¦„ í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬ ë…¸ì¶œ (ì½ê¸° ì „ìš©)',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:2,tag:'auth',  text:'ë¹„í™œì„±í™” ë²„íŠ¼ - SUPER ADMINë§Œ ë…¸ì¶œ',author:'ê¸°íšì',date:'02-26',resolved:false},
        ]
      },
      {
        id:'p3', type:'screen', name:'ê¶Œí•œ ê´€ë¦¬',
        screenId:'ADM-AUTH-001', path:'ì–´ë“œë¯¼ > íšŒì›ê´€ë¦¬ > ê¶Œí•œ ê´€ë¦¬',
        group:'íšŒì›ê´€ë¦¬',
        notes:[
          {id:1,tag:'backend', text:'ê¶Œí•œ ë³€ê²½ì€ ì¦‰ì‹œ ë°˜ì˜ (ì €ì¥ ë²„íŠ¼ ì—†ìŒ)',author:'ê¸°íšì',date:'02-26',resolved:false},
          {id:2,tag:'auth',    text:'SUPER ADMINë§Œ ê¶Œí•œ ìˆ˜ì • ê°€ëŠ¥',author:'ê¸°íšì',date:'02-26',resolved:false},
        ]
      },
    ]
  }
];

// ë©”ëª¨ë¦¬ ê¸°ë°˜ ìƒíƒœ (Claude ê²Œì‹œ í™˜ê²½)
let projects = JSON.parse(JSON.stringify(DEFAULT_PROJECTS));
let currentProjectId = projects[0].id;

function getCurrentProject(){
  return projects.find(p => p.id === currentProjectId) || projects[0];
}

// pagesëŠ” currentProjectì˜ pagesë¥¼ ì°¸ì¡°
let pages = getCurrentProject().pages;

// â”€â”€ ê¸°íšì„œ ë¦¬ìŠ¤íŠ¸ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showProjectList(){
  document.getElementById('projectListView').style.display = 'block';
  document.querySelector('.shell').style.display = 'none';
  renderProjectGrid();
}

function showProjectDetail(){
  document.getElementById('projectListView').style.display = 'none';
  document.querySelector('.shell').style.display = 'flex';
}

function goToProjectList(){
  // í˜„ì¬ í”„ë¡œì íŠ¸ pages ì €ì¥
  getCurrentProject().pages = pages;
  getCurrentProject()._pendingGroups = window._pendingGroups || [];
  showProjectList();
}

function renderProjectGrid(){
  const grid = document.getElementById('projectGrid');
  if(!grid) return;
  if(projects.length === 0){
    grid.innerHTML = `<div class="pl-empty">
      <div class="pl-empty-icon">ğŸ“‚</div>
      <div class="pl-empty-text">ì•„ì§ ê¸°íšì„œê°€ ì—†ì–´ìš”. ìƒˆ ê¸°íšì„œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.</div>
    </div>`;
    return;
  }
  const icons = ['ğŸ“','ğŸ—‚','ğŸ“‹','ğŸ“Š','ğŸ–¥','ğŸ“±','âš™ï¸','ğŸ¨'];
  grid.innerHTML = projects.map((proj, i) => {
    const icon = icons[i % icons.length];
    const pageCount = (proj.pages||[]).length;
    const date = new Date(proj.createdAt).toLocaleDateString('ko-KR',{month:'short',day:'numeric'});
    return `
    <div class="pl-card" onclick="openProject('${proj.id}')">
      <div class="pl-card-actions" onclick="event.stopPropagation()">
        <button class="pl-card-action-btn" title="ì´ë¦„ ë³€ê²½" onclick="renameProject('${proj.id}')">âœï¸</button>
        <button class="pl-card-action-btn" title="ë³µì‚¬" onclick="duplicateProject('${proj.id}')">â§‰</button>
        ${projects.length > 1 ? `<button class="pl-card-action-btn danger" title="ì‚­ì œ" onclick="deleteProject('${proj.id}')">ğŸ—‘</button>` : ''}
      </div>
      <div class="pl-card-icon">${icon}</div>
      <div class="pl-card-name">${escHtml(proj.name)}</div>
      <div class="pl-card-desc">${escHtml(proj.desc||'')}</div>
      <div class="pl-card-meta">
        <span class="pl-card-pages">í˜ì´ì§€ ${pageCount}ê°œ</span>
        <span class="pl-card-date">${date}</span>
      </div>
    </div>`;
  }).join('');
}

function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function openProject(projId){
  currentProjectId = projId;
  const proj = getCurrentProject();
  pages = proj.pages || [];
  window._pendingGroups = proj._pendingGroups || [];
  // í˜„ì¬ í”„ë¡œì íŠ¸ëª… ì—…ë°ì´íŠ¸
  const nameEl = document.getElementById('currentProjectName');
  if(nameEl) nameEl.textContent = proj.name;
  currentIdx = 0;
  showProjectDetail();
  renderAll();
}

// â”€â”€ ìƒˆ ê¸°íšì„œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _duplicatingFromId = null;

function createNewProject(){
  _duplicatingFromId = null;
  document.getElementById('newProjectModalTitle').textContent = 'ìƒˆ ê¸°íšì„œ ë§Œë“¤ê¸°';
  document.getElementById('newProjectSubmitBtn').textContent = 'ë§Œë“¤ê¸°';
  document.getElementById('newProjectName').value = '';
  document.getElementById('newProjectDesc').value = '';
  document.getElementById('newProjectModal').classList.remove('hidden');
  setTimeout(()=> document.getElementById('newProjectName').focus(), 80);
}

function duplicateProject(projId){
  _duplicatingFromId = projId;
  const src = projects.find(p=>p.id===projId);
  document.getElementById('newProjectModalTitle').textContent = 'ê¸°íšì„œ ë³µì‚¬í•˜ê¸°';
  document.getElementById('newProjectSubmitBtn').textContent = 'ë³µì‚¬í•˜ê¸°';
  document.getElementById('newProjectName').value = src.name + ' (ë³µì‚¬ë³¸)';
  document.getElementById('newProjectDesc').value = src.desc || '';
  document.getElementById('newProjectModal').classList.remove('hidden');
  setTimeout(()=> document.getElementById('newProjectName').focus(), 80);
}

function closeNewProjectModal(){
  document.getElementById('newProjectModal').classList.add('hidden');
  _duplicatingFromId = null;
}

function confirmNewProject(){
  const name = document.getElementById('newProjectName').value.trim();
  if(!name){ document.getElementById('newProjectName').focus(); return; }
  const desc = document.getElementById('newProjectDesc').value.trim();

  let newPages = [];
  let newPendingGroups = [];

  if(_duplicatingFromId){
    // ë³µì‚¬: pages ë”¥ì¹´í”¼
    const src = projects.find(p=>p.id===_duplicatingFromId);
    newPages = JSON.parse(JSON.stringify(src.pages||[]));
    newPendingGroups = JSON.parse(JSON.stringify(src._pendingGroups||[]));
    // id ì¬ë°œê¸‰
    newPages = newPages.map((p,i)=>({...p, id:'p_'+Date.now()+'_'+i}));
  }

  const proj = {
    id: 'proj_' + Date.now(),
    name, desc,
    createdAt: Date.now(),
    _pendingGroups: newPendingGroups,
    pages: newPages
  };
  projects.push(proj);
  closeNewProjectModal();
  renderProjectGrid();
  showToast(_duplicatingFromId ? `"${name}" ë³µì‚¬ ì™„ë£Œ!` : `"${name}" ê¸°íšì„œê°€ ë§Œë“¤ì–´ì¡Œì–´ìš”!`);
}

function renameProject(projId){
  const proj = projects.find(p=>p.id===projId);
  if(!proj) return;
  openInputModal('ê¸°íšì„œ ì´ë¦„ ë³€ê²½', proj.name, (val)=>{
    if(!val.trim()) return;
    proj.name = val.trim();
    renderProjectGrid();
    if(projId === currentProjectId){
      const nameEl = document.getElementById('currentProjectName');
      if(nameEl) nameEl.textContent = proj.name;
    }
  });
}

function renameCurrentProject(){
  renameProject(currentProjectId);
}

function deleteProject(projId){
  if(projects.length <= 1){ showToast('ê¸°íšì„œëŠ” ìµœì†Œ 1ê°œ ì´ìƒ ìˆì–´ì•¼ í•´ìš”.'); return; }
  const proj = projects.find(p=>p.id===projId);
  if(!confirm(`"${proj.name}" ê¸°íšì„œë¥¼ ì‚­ì œí• ê¹Œìš”?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš”.`)) return;
  projects = projects.filter(p=>p.id!==projId);
  if(currentProjectId === projId) currentProjectId = projects[0].id;
  renderProjectGrid();
  showToast('ì‚­ì œëì–´ìš”.');
}

// ============================================================
//  ë°ì´í„° (pagesëŠ” ìœ„ì—ì„œ currentProject ê¸°ë°˜ìœ¼ë¡œ ì„ ì–¸ë¨)
// ============================================================
const TAG_LABEL = {backend:'ë°±ì—”ë“œì •ì±…',popup:'íŒì—…ì •ì±…',auth:'ê¶Œí•œì •ì±…',security:'ë³´ì•ˆì •ì±…',ui:'UIì •ì±…',pending:'ë¯¸í™•ì •'};
const TAG_CLS   = {backend:'t-backend',popup:'t-popup',auth:'t-auth',security:'t-security',ui:'t-ui',pending:'t-pending'};
const TYPE_LABEL= {screen:'í™”ë©´',popup:'íŒì—…',webview:'ì›¹ë·°'};
const TYPE_CLS  = {screen:'type-screen',popup:'type-popup',webview:'type-webview'};
const TYPE_ICON = {screen:'ğŸ–¥',popup:'ğŸ’¬',webview:'ğŸ“±'};

let currentIdx = 0;
let noteFilter = 'all';
let composing  = false;
let selectedTag= null;
let noteNextId = 100;
let modalType  = 'screen';

// ============================================================
//  í˜ì´ì§€ ë Œë”ë§
// ============================================================
function renderAll(){
  renderNav();
  renderCanvas();
  renderPad();
}

function renderNav(filter=''){
  const list = document.getElementById('navList');
  const groups = {};
  pages.forEach((p,i)=>{
    const g = p.group||'ê¸°íƒ€';
    if(!groups[g]) groups[g]=[];
    groups[g].push({p,i});
  });

  // ë¹ˆ ê·¸ë£¹(í˜ì´ì§€ ì—†ì´ ìƒì„±ëœ ê·¸ë£¹)ë„ í¬í•¨
  (window._pendingGroups||[]).forEach(g=>{
    if(!groups[g]) groups[g]=[];
  });

  list.innerHTML = Object.entries(groups).map(([g, items])=>`
    <div class="nav-group">
      <div class="nav-group-label" onclick="toggleGroup(this)" ondblclick="startGroupRename(event,'${g}')">
        <span class="nav-group-name">${g}</span>
        <span class="nav-group-arrow">â–¾</span>
      </div>
      <div class="nav-group-children">
        ${items.length === 0
          ? `<div style="font-size:11px;color:var(--text-muted);padding:8px 12px;font-style:italic;">í˜ì´ì§€ ì—†ìŒ Â· ìš°í´ë¦­ìœ¼ë¡œ ì´ë™</div>`
          : items
            .filter(({p})=> !filter || p.name.includes(filter) || p.screenId.includes(filter))
            .map(({p,i})=>`
          <div class="nav-item ${i===currentIdx?'active':''}"
            draggable="true"
            data-idx="${i}"
            onclick="navItemClick(event,${i})"
            oncontextmenu="openCtxMenu(event,${i})"
            ondragstart="onDragStart(event,${i})"
            ondragover="onDragOver(event,${i})"
            ondragleave="onDragLeave(event)"
            ondrop="onDrop(event,${i})"
            ondragend="onDragEnd(event)">
            <span class="drag-handle" onmousedown="event.stopPropagation()">â ¿</span>
            <span class="nav-item-icon">${TYPE_ICON[p.type]||'ğŸ–¥'}</span>
            <div class="nav-item-info">
              <div class="nav-item-name">${p.name}</div>
              <div class="nav-item-id">${p.screenId}</div>
            </div>
            <span class="nav-item-type ${TYPE_CLS[p.type]}">${TYPE_LABEL[p.type]}</span>
          </div>`).join('')
        }
      </div>
    </div>
  `).join('');
}

// í´ë¦­ê³¼ ë“œë˜ê·¸ êµ¬ë¶„ (ë“œë˜ê·¸ ì‹œ í˜ì´ì§€ ì´ë™ ë°©ì§€)
let _dragMoved = false;
function navItemClick(e, i){
  if(_dragMoved) return;
  goToPage(i);
}

let dragSrcIdx = null;
function onDragStart(e, i){
  _dragMoved = false;
  dragSrcIdx = i;
  e.dataTransfer.effectAllowed = 'move';
  setTimeout(()=> e.target.closest('.nav-item').classList.add('dragging'), 0);
}

function onDragOver(e, i){
  e.preventDefault();
  _dragMoved = true;
  e.dataTransfer.dropEffect = 'move';
  const el = e.target.closest('.nav-item');
  if(!el || i === dragSrcIdx) return;
  document.querySelectorAll('.nav-item').forEach(n=>{
    n.classList.remove('drag-over-top','drag-over-bottom');
  });
  const rect = el.getBoundingClientRect();
  const mid  = rect.top + rect.height / 2;
  el.classList.add(e.clientY < mid ? 'drag-over-top' : 'drag-over-bottom');
}

function onDragLeave(e){
  const el = e.target.closest('.nav-item');
  if(el) el.classList.remove('drag-over-top','drag-over-bottom');
}

function onDrop(e, targetIdx){
  e.preventDefault();
  document.querySelectorAll('.nav-item').forEach(n=>{
    n.classList.remove('drag-over-top','drag-over-bottom','dragging');
  });
  if(dragSrcIdx === null || dragSrcIdx === targetIdx) return;

  const el   = e.target.closest('.nav-item');
  const rect = el.getBoundingClientRect();
  const mid  = rect.top + rect.height / 2;
  const insertAfter = e.clientY >= mid;

  const moved = pages.splice(dragSrcIdx, 1)[0];
  let newTarget = targetIdx > dragSrcIdx ? targetIdx - 1 : targetIdx;
  if(insertAfter) newTarget += 1;
  pages.splice(newTarget, 0, moved);

  // currentIdx ë³´ì •
  if(currentIdx === dragSrcIdx){
    currentIdx = newTarget;
  } else {
    // ê¸°ì¡´ ì„ íƒëœ í˜ì´ì§€ ìœ„ì¹˜ ì¬ê³„ì‚°
    const selectedId = pages[currentIdx] ? pages[currentIdx].id : null;
    currentIdx = pages.findIndex(p => p.id === selectedId);
    if(currentIdx < 0) currentIdx = 0;
  }

  dragSrcIdx = null;
  renderAll();
  persistPages();
}

function onDragEnd(e){
  document.querySelectorAll('.nav-item').forEach(n=>{
    n.classList.remove('drag-over-top','drag-over-bottom','dragging');
  });
  dragSrcIdx = null;
  setTimeout(()=> _dragMoved = false, 50);
}

function toggleGroup(el){
  const children = el.nextElementSibling;
  const arrow = el.querySelector('.nav-group-arrow');
  const hidden = children.style.display==='none';
  children.style.display = hidden?'':'none';
  arrow.classList.toggle('collapsed', !hidden);
}

function renderCanvas(){
  const p = pages[currentIdx];
  if(!p) return;

  // íˆ´ë°”
  document.getElementById('toolbarName').value = p.name;
  document.getElementById('toolbarTypeBadge').className = 'page-type-badge '+TYPE_CLS[p.type];
  document.getElementById('toolbarTypeBadge').textContent = TYPE_LABEL[p.type];
  document.getElementById('metaId').value   = p.screenId;
  document.getElementById('metaPath').value = p.path;

  // ì´ì „/ë‹¤ìŒ ë²„íŠ¼
  document.getElementById('btnPrev').disabled = currentIdx===0;
  document.getElementById('btnNext').disabled = currentIdx===pages.length-1;
  document.getElementById('cntCurrent').textContent = currentIdx+1;
  document.getElementById('cntTotal').textContent   = pages.length;

  // ì  ë„¤ë¹„ê²Œì´í„°
  const dots = document.getElementById('pageDots');
  dots.innerHTML = pages.map((_,i)=>`<div class="page-dot ${i===currentIdx?'active':''}" onclick="goToPage(${i})" title="${pages[i].name}"></div>`).join('');

  // í”„ë ˆì„ ë Œë”
  const fw = document.getElementById('frameWrapper');
  const html = getPageHTML(p);
  if(html){
    fw.className = 'frame-wrapper';
    if(p.generatedHTML){
      renderInIframe(fw, html);
    } else {
      fw.innerHTML = html;
      ensureEditBar(fw);
    }
  } else {
    fw.className = 'frame-empty';
    fw.innerHTML = `
      <div class="frame-empty-icon">âœ¦</div>
      <div class="frame-empty-title">AIë¡œ í™”ë©´ ìƒì„±í•˜ê¸°</div>
      <div class="frame-empty-sub">ì–´ë–¤ í™”ë©´ì„ ë§Œë“¤ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”</div>
      <button class="frame-empty-cta" onclick="openAiInput()">âœ¦ ëª…ë ¹ ì…ë ¥í•˜ê¸°</button>`;
  }
}

function renderInIframe(fw, html){
  fw.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'ai-screen-wrap';
  wrap.style.cssText = 'width:100%;min-height:600px;display:block;';
  wrap.innerHTML = html;
  fw.appendChild(wrap);
  ensureEditBar(fw);
}

function renderPad(){
  const p = pages[currentIdx];
  document.getElementById('padScreenId').textContent = p.screenId;
  const notes = noteFilter==='all' ? p.notes : p.notes.filter(n=>n.tag===noteFilter);
  const list = document.getElementById('padList');
  if(!notes.length){
    list.innerHTML=`<div class="pad-empty"><div class="pad-empty-icon">ğŸ—’ï¸</div><div>ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>`;
    return;
  }
  list.innerHTML = notes.map(n=>`
    <div class="ncard ${n.resolved?'resolved':''}" id="nc-${n.id}">
      <div class="ncard-top">
        <span class="ntag ${TAG_CLS[n.tag]}">${TAG_LABEL[n.tag]}</span>
        <div class="ncard-acts">
          <button class="nact" onclick="editNote(${n.id})" title="ìˆ˜ì •">âœ</button>
          <button class="nact" onclick="delNote(${n.id})" title="ì‚­ì œ" style="color:var(--danger)">âœ•</button>
        </div>
      </div>
      <div class="nbody" id="nb-${n.id}">${n.text}</div>
      <div class="nfoot">
        <span class="nmeta">${n.author} Â· ${n.date}</span>
        <button class="nresolve ${n.resolved?'done':''}" onclick="toggleResolve(${n.id})">${n.resolved?'âœ“ í•´ê²°ë¨':'í•´ê²°'}</button>
      </div>
    </div>`).join('');
}

// ============================================================
//  í˜ì´ì§€ HTML ì •ì˜
// ============================================================
function getPageHTML(p){
  if(p.generatedHTML) return p.generatedHTML;
  if(p.id==='p1') return htmlUserList();
  if(p.id==='p2') return htmlUserDetail();
  if(p.id==='p3') return htmlUserAdd();
  if(p.id==='p4') return htmlRoleManage();
  return '';
}

function htmlUserList(){
  return `<div class="emb-wrap">
  <div class="emb-topbar">
    <div class="emb-breadcrumb">í™ˆ <span style="color:#505878">â€º</span> íšŒì›ê´€ë¦¬ <span style="color:#505878">â€º</span> <span>ì‚¬ìš©ì ê´€ë¦¬</span></div>
    <span class="emb-topbadge">SUPER ADMIN</span>
  </div>
  <div class="emb-body">
    <div class="emb-ph">
      <div>
        <div class="emb-ptitle">ì‚¬ìš©ì ê´€ë¦¬</div>
        <div class="emb-psub">ì „ì²´ ì‚¬ìš©ì ê³„ì •ì„ ì¡°íšŒí•˜ê³  ê¶Œí•œì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
        <div class="emb-sid">ADM-USR-001</div>
      </div>
      <button class="emb-btn emb-btn-p">+ ì‚¬ìš©ì ë“±ë¡</button>
    </div>
    <div class="emb-filter">
      <div class="emb-fg"><div class="emb-flabel">ì´ë¦„ / ì´ë©”ì¼</div><input class="emb-input" style="min-width:180px" placeholder="ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ì…ë ¥"></div>
      <div class="emb-fg"><div class="emb-flabel">ê³„ì • ìƒíƒœ</div><select class="emb-select"><option>ì „ì²´</option><option>í™œì„±</option><option>ë¹„í™œì„±</option><option>ì‹¬ì‚¬ì¤‘</option></select></div>
      <div class="emb-fg"><div class="emb-flabel">ê¶Œí•œ</div><select class="emb-select"><option>ì „ì²´</option><option>ìŠˆí¼ì–´ë“œë¯¼</option><option>ì–´ë“œë¯¼</option><option>ë§¤ë‹ˆì €</option></select></div>
      <div class="emb-fg"><div class="emb-flabel">ê°€ì…ì¼</div><input type="date" class="emb-input"></div>
      <div style="display:flex;gap:7px;align-items:flex-end">
        <button class="emb-btn emb-btn-p">ì¡°íšŒ</button>
        <button class="emb-btn emb-btn-s">ì´ˆê¸°í™”</button>
      </div>
    </div>
    <div class="emb-th-row">
      <div class="emb-rc">ì´ <strong>247</strong>ëª…</div>
      <div style="display:flex;gap:7px">
        <button class="emb-btn emb-btn-s emb-btn-sm">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        <button class="emb-btn emb-btn-do emb-btn-sm">ì„ íƒ ë¹„í™œì„±í™”</button>
      </div>
    </div>
    <div class="emb-table-wrap">
      <table class="emb-table">
        <thead><tr>
          <th><input type="checkbox"></th><th>No.</th><th>ì´ë¦„</th><th>ì´ë©”ì¼</th>
          <th>ê¶Œí•œ</th><th>ê³„ì • ìƒíƒœ</th><th>ê°€ì…ì¼</th><th>ë§ˆì§€ë§‰ ë¡œê·¸ì¸</th><th>ê´€ë¦¬</th>
        </tr></thead>
        <tbody>
          <tr><td><input type="checkbox"></td><td style="color:#505878">247</td><td><span class="emb-link">ê¹€ë¯¼ì¤€</span></td><td style="color:#8892b0">minjun.kim@co.com</td><td><span class="emb-role emb-role-admin">ì–´ë“œë¯¼</span></td><td><span class="emb-badge emb-badge-a"><span class="emb-dot"></span>í™œì„±</span></td><td style="color:#8892b0">2025-12-01</td><td style="color:#8892b0">2026-02-26 09:43</td><td><button class="emb-btn emb-btn-s emb-btn-sm">ìˆ˜ì •</button></td></tr>
          <tr><td><input type="checkbox"></td><td style="color:#505878">246</td><td><span class="emb-link">ì´ì„œì—°</span></td><td style="color:#8892b0">seoyeon.lee@co.com</td><td><span class="emb-role emb-role-mgr">ë§¤ë‹ˆì €</span></td><td><span class="emb-badge emb-badge-a"><span class="emb-dot"></span>í™œì„±</span></td><td style="color:#8892b0">2025-11-15</td><td style="color:#8892b0">2026-02-25 18:20</td><td><button class="emb-btn emb-btn-s emb-btn-sm">ìˆ˜ì •</button></td></tr>
          <tr><td><input type="checkbox"></td><td style="color:#505878">245</td><td><span class="emb-link">ë°•ë„í˜„</span></td><td style="color:#8892b0">dohyun.park@co.com</td><td><span class="emb-role emb-role-view">ë·°ì–´</span></td><td><span class="emb-badge emb-badge-i"><span class="emb-dot"></span>ë¹„í™œì„±</span></td><td style="color:#8892b0">2025-10-08</td><td style="color:#8892b0">2026-01-10 11:05</td><td><button class="emb-btn emb-btn-s emb-btn-sm">ìˆ˜ì •</button></td></tr>
          <tr><td><input type="checkbox"></td><td style="color:#505878">244</td><td><span class="emb-link">ìµœìœ ì§„</span></td><td style="color:#8892b0">yujin.choi@co.com</td><td><span class="emb-role emb-role-mgr">ë§¤ë‹ˆì €</span></td><td><span class="emb-badge emb-badge-p"><span class="emb-dot"></span>ì‹¬ì‚¬ì¤‘</span></td><td style="color:#8892b0">2026-02-24</td><td style="color:#8892b0">-</td><td><button class="emb-btn emb-btn-s emb-btn-sm">ìˆ˜ì •</button></td></tr>
          <tr><td><input type="checkbox"></td><td style="color:#505878">243</td><td><span class="emb-link">ì •í˜„ìš°</span></td><td style="color:#8892b0">hyunwoo.jung@co.com</td><td><span class="emb-role emb-role-admin">ì–´ë“œë¯¼</span></td><td><span class="emb-badge emb-badge-a"><span class="emb-dot"></span>í™œì„±</span></td><td style="color:#8892b0">2025-09-20</td><td style="color:#8892b0">2026-02-26 08:11</td><td><button class="emb-btn emb-btn-s emb-btn-sm">ìˆ˜ì •</button></td></tr>
        </tbody>
      </table>
    </div>
    <div class="emb-page">
      <div class="emb-pgbtn">â€¹â€¹</div><div class="emb-pgbtn">â€¹</div>
      <div class="emb-pgbtn act">1</div><div class="emb-pgbtn">2</div><div class="emb-pgbtn">3</div>
      <div class="emb-pgbtn">â€º</div><div class="emb-pgbtn">â€ºâ€º</div>
    </div>
  </div>
</div>`;
}

function htmlUserDetail(){
  return `<div class="emb-popup-bg" style="position:relative;min-height:600px">
  <div style="position:absolute;inset:0;background:rgba(15,17,23,.85);display:flex;align-items:center;justify-content:center">
    <div class="emb-modal">
      <div class="emb-modal-title">ì‚¬ìš©ì ìƒì„¸</div>
      <div class="emb-form-row">
        <div class="emb-form-g"><div class="emb-form-label">ì´ë¦„</div><div class="emb-form-val">ê¹€ë¯¼ì¤€</div></div>
        <div class="emb-form-g"><div class="emb-form-label">ì´ë©”ì¼</div><div class="emb-form-val">minjun.kim@company.com</div></div>
        <div class="emb-form-g"><div class="emb-form-label">ê¶Œí•œ</div><div class="emb-form-val">ì–´ë“œë¯¼</div></div>
        <div class="emb-form-g"><div class="emb-form-label">ê³„ì • ìƒíƒœ</div><div class="emb-form-val">í™œì„±</div></div>
        <div class="emb-form-g"><div class="emb-form-label">ê°€ì…ì¼</div><div class="emb-form-val">2025-12-01</div></div>
        <div class="emb-form-g"><div class="emb-form-label">ë§ˆì§€ë§‰ ë¡œê·¸ì¸</div><div class="emb-form-val">2026-02-26 09:43</div></div>
        <div class="emb-form-g full"><div class="emb-form-label">ë©”ëª¨</div><div class="emb-form-val" style="min-height:50px">â€”</div></div>
      </div>
      <div class="emb-mfooter">
        <button class="emb-btn emb-btn-do emb-btn-sm">ë¹„í™œì„±í™”</button>
        <button class="emb-btn emb-btn-s">ë‹«ê¸°</button>
        <button class="emb-btn emb-btn-p">ìˆ˜ì •</button>
      </div>
    </div>
  </div>
</div>`;
}

function htmlUserAdd(){
  return `<div class="emb-popup-bg" style="position:relative;min-height:600px">
  <div style="position:absolute;inset:0;background:rgba(15,17,23,.85);display:flex;align-items:center;justify-content:center">
    <div class="emb-modal">
      <div class="emb-modal-title">ì‚¬ìš©ì ë“±ë¡</div>
      <div class="emb-form-row">
        <div class="emb-form-g"><div class="emb-form-label">ì´ë¦„ *</div><input class="emb-input" placeholder="í™ê¸¸ë™" style="min-width:0;width:100%"></div>
        <div class="emb-form-g"><div class="emb-form-label">ì´ë©”ì¼ *</div><input class="emb-input" placeholder="user@company.com" style="min-width:0;width:100%"></div>
        <div class="emb-form-g"><div class="emb-form-label">ê¶Œí•œ *</div><select class="emb-select" style="width:100%"><option>ì„ íƒ</option><option>ì–´ë“œë¯¼</option><option>ë§¤ë‹ˆì €</option><option>ë·°ì–´</option></select></div>
        <div class="emb-form-g"><div class="emb-form-label">ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ *</div><input type="password" class="emb-input" placeholder="8ì ì´ìƒ" style="min-width:0;width:100%"></div>
        <div class="emb-form-g full"><div class="emb-form-label">ë©”ëª¨</div><input class="emb-input" placeholder="ê´€ë¦¬ìš© ë©”ëª¨ (ì„ íƒ)" style="width:100%"></div>
      </div>
      <div class="emb-mfooter">
        <button class="emb-btn emb-btn-s">ì·¨ì†Œ</button>
        <button class="emb-btn emb-btn-p">ë“±ë¡</button>
      </div>
    </div>
  </div>
</div>`;
}

function htmlRoleManage(){
  const rows = [
    ['ì‚¬ìš©ì ë“±ë¡/ìˆ˜ì •','ìŠˆí¼ì–´ë“œë¯¼','ì–´ë“œë¯¼','ë§¤ë‹ˆì €','ë·°ì–´'],
  ].map(()=>''); // placeholder
  return `<div class="emb-wrap">
  <div class="emb-topbar">
    <div class="emb-breadcrumb">í™ˆ <span style="color:#505878">â€º</span> íšŒì›ê´€ë¦¬ <span style="color:#505878">â€º</span> <span>ê¶Œí•œ ê´€ë¦¬</span></div>
    <span class="emb-topbadge">SUPER ADMIN</span>
  </div>
  <div class="emb-body">
    <div class="emb-ph">
      <div>
        <div class="emb-ptitle">ê¶Œí•œ ê´€ë¦¬</div>
        <div class="emb-psub">ì—­í• ë³„ ë©”ë‰´ ì ‘ê·¼ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
        <div class="emb-sid">ADM-AUTH-001</div>
      </div>
    </div>
    <div class="emb-table-wrap">
      <table class="emb-role-table">
        <thead><tr>
          <th style="width:220px">ê¸°ëŠ¥</th>
          <th style="text-align:center">ìŠˆí¼ì–´ë“œë¯¼</th>
          <th style="text-align:center">ì–´ë“œë¯¼</th>
          <th style="text-align:center">ë§¤ë‹ˆì €</th>
          <th style="text-align:center">ë·°ì–´</th>
        </tr></thead>
        <tbody>
          ${[
            ['ì‚¬ìš©ì ì¡°íšŒ',true,true,true,true],
            ['ì‚¬ìš©ì ë“±ë¡/ìˆ˜ì •',true,true,false,false],
            ['ì‚¬ìš©ì ë¹„í™œì„±í™”',true,false,false,false],
            ['ê¶Œí•œ ê´€ë¦¬',true,false,false,false],
            ['ê³µì§€ì‚¬í•­ ë“±ë¡',true,true,true,false],
            ['ê³µì§€ì‚¬í•­ ì‚­ì œ',true,true,false,false],
            ['ì—‘ì…€ ë‹¤ìš´ë¡œë“œ',true,true,true,false],
            ['ì ‘ì† ë¡œê·¸ ì¡°íšŒ',true,false,false,false],
          ].map(([name,...vals])=>`
          <tr>
            <td style="color:#e8ecf4;font-weight:500">${name}</td>
            ${vals.map(v=>`<td style="text-align:center">
              <label class="emb-toggle">
                <input type="checkbox" ${v?'checked':''}>
                <span class="emb-slider"></span>
              </label>
            </td>`).join('')}
          </tr>`).join('')}
        </tbody>
      </table>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-top:16px;gap:8px">
      <button class="emb-btn emb-btn-s">ì´ˆê¸°í™”</button>
      <button class="emb-btn emb-btn-p">ì €ì¥</button>
    </div>
  </div>
</div>`;
}

// ============================================================
//  ë„¤ë¹„ê²Œì´ì…˜
// ============================================================
function goToPage(i){
  currentIdx = i;
  noteFilter = 'all';
  composing  = false;
  document.getElementById('padCompose').classList.remove('open');
  document.querySelectorAll('.fchip').forEach(c=>c.classList.remove('on'));
  document.querySelectorAll('.fchip')[0].classList.add('on');
  renderAll();
}

function goPage(dir){
  const next = currentIdx + dir;
  if(next>=0 && next<pages.length) goToPage(next);
}

function searchPages(val){
  renderNav(val);
}

// ============================================================
//  í˜ì´ì§€ ì¶”ê°€/ì‚­ì œ
// ============================================================
function openAddModal(){
  document.getElementById('mName').value='';
  document.getElementById('mId').value='';
  document.getElementById('mPath').value='';
  document.getElementById('mGroupInput').value='';
  modalType='screen';
  document.querySelectorAll('.mtype-btn').forEach(b=>{
    b.classList.toggle('sel', b.dataset.type==='screen');
  });
  // ê¸°ì¡´ ê·¸ë£¹ ëª©ë¡ ì±„ìš°ê¸° (pendingGroups í¬í•¨)
  const groups = [...new Set([
    ...pages.map(p=>p.group||'ê¸°íƒ€'),
    ...(window._pendingGroups||[])
  ])];
  const sel = document.getElementById('mGroupSelect');
  sel.innerHTML = '<option value="">-- ê·¸ë£¹ ì„ íƒ --</option>'
    + groups.map(g=>`<option value="${g}">${g}</option>`).join('');
  document.getElementById('addModal').classList.remove('hidden');
  setTimeout(()=>document.getElementById('mName').focus(), 50);
}
function closeAddModal(){ document.getElementById('addModal').classList.add('hidden'); }
function selModalType(btn){
  modalType = btn.dataset.type;
  document.querySelectorAll('.mtype-btn').forEach(b=>b.classList.remove('sel'));
  btn.classList.add('sel');
}
function onGroupSelectChange(sel){
  if(sel.value) document.getElementById('mGroupInput').value = sel.value;
}
function confirmAddPage(){
  const name  = document.getElementById('mName').value.trim();
  const sid   = document.getElementById('mId').value.trim();
  const path  = document.getElementById('mPath').value.trim();
  const group = document.getElementById('mGroupInput').value.trim()
             || document.getElementById('mGroupSelect').value
             || 'ì‹ ê·œ';
  if(!name||!sid){ alert('í™”ë©´ëª…ê³¼ í™”ë©´ IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }
  pages.push({
    id:'p'+Date.now(), type:modalType,
    name, screenId:sid, path, group,
    notes:[], history:[]
  });
  // ë¹ˆ ê·¸ë£¹ ëª©ë¡ì—ì„œ ì œê±°
  if(window._pendingGroups)
    window._pendingGroups = window._pendingGroups.filter(g=>g!==group);
  closeAddModal();
  goToPage(pages.length-1);
  persistPages();
}

function addNewGroup(){
  openInputModal('ìƒˆ ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', '', (name)=>{
    if(!name?.trim()) return;
    const trimmed = name.trim();
    const exists = pages.some(p => p.group === trimmed)
      || (window._pendingGroups||[]).includes(trimmed);
    if(exists){ alert(`"${trimmed}" ê·¸ë£¹ì´ ì´ë¯¸ ìˆì–´ìš”.`); return; }
    if(!window._pendingGroups) window._pendingGroups = [];
    window._pendingGroups.push(trimmed);
    renderNav();
  });
}

// renderNavì—ì„œ pendingGroupsë„ ì„¹ì…˜ìœ¼ë¡œ í‘œì‹œ

// ê³µìš© í…ìŠ¤íŠ¸ ì…ë ¥ ëª¨ë‹¬
function openInputModal(title, defaultVal, onConfirm){
  const overlay = document.getElementById('inputModalOverlay');
  document.getElementById('inputModalTitle').textContent = title;
  const inp = document.getElementById('inputModalField');
  inp.value = defaultVal || '';
  overlay.classList.remove('hidden');
  setTimeout(()=>{ inp.focus(); inp.select(); }, 50);
  document.getElementById('inputModalConfirm').onclick = ()=>{
    const val = inp.value.trim();
    overlay.classList.add('hidden');
    onConfirm(val);
  };
  document.getElementById('inputModalCancel').onclick = ()=>{
    overlay.classList.add('hidden');
  };
  inp.onkeydown = e=>{
    if(e.key==='Enter'){ e.preventDefault(); document.getElementById('inputModalConfirm').click(); }
    if(e.key==='Escape') overlay.classList.add('hidden');
  };
}

function openCtxMenu(e, idx){
  e.preventDefault();
  e.stopPropagation();
  ctxTargetIdx = idx;
  const menu = document.getElementById('ctxMenu');
  menu.style.left = e.clientX + 'px';
  menu.style.top  = e.clientY + 'px';
  menu.classList.add('show');

  document.getElementById('ctxMoveGroup').onclick = showGroupSubMenu;
  document.getElementById('ctxRenameGroup').onclick = ()=>{
    closeCtxMenu();
    startGroupRenameByIdx(ctxTargetIdx);
  };
}

function showGroupSubMenu(){
  const menu = document.getElementById('ctxMenu');
  const sub  = document.getElementById('ctxGroupMenu');
  const rect = document.getElementById('ctxMoveGroup').getBoundingClientRect();

  const currentGroup = pages[ctxTargetIdx]?.group || '';
  const groups = [...new Set(pages.map(p=>p.group||'ê¸°íƒ€'))].filter(g=>g!==currentGroup);

  sub.innerHTML = groups.map(g=>
    `<div class="ctx-item" onclick="moveToGroup('${g}')">${g}</div>`
  ).join('')
  + (groups.length ? '<div class="ctx-sep"></div>' : '')
  + `<div class="ctx-item" onclick="moveToNewGroup()">ï¼‹ ìƒˆ ê·¸ë£¹ìœ¼ë¡œ ì´ë™</div>`;

  sub.style.left = (rect.right + 4) + 'px';
  sub.style.top  = rect.top + 'px';
  sub.classList.add('show');
}

function moveToGroup(g){
  if(ctxTargetIdx === null) return;
  pages[ctxTargetIdx].group = g;
  closeCtxMenu();
  renderNav();
  persistPages();
}

function moveToNewGroup(){
  openInputModal('ìƒˆ ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', '', (g)=>{
    if(!g?.trim()) return;
    if(ctxTargetIdx !== null) pages[ctxTargetIdx].group = g.trim();
    if(window._pendingGroups)
      window._pendingGroups = window._pendingGroups.filter(pg=>pg!==g.trim());
    closeCtxMenu();
    renderNav();
    persistPages();
  });
}

function closeCtxMenu(){
  document.getElementById('ctxMenu').classList.remove('show');
  document.getElementById('ctxGroupMenu').classList.remove('show');
  ctxTargetIdx = null;
}

// ê·¸ë£¹ëª… ë”ë¸”í´ë¦­ ì¸ë¼ì¸ í¸ì§‘
function startGroupRename(e, groupName){
  e.stopPropagation();
  const span = e.currentTarget.querySelector('.nav-group-name');
  if(!span) return;
  const input = document.createElement('input');
  input.className = 'nav-group-name-input';
  input.value = groupName;
  span.replaceWith(input);
  input.focus();
  input.select();
  const commit = ()=>{
    const newName = input.value.trim() || groupName;
    if(newName !== groupName){
      pages.forEach(p=>{ if(p.group===groupName) p.group=newName; });
      if(window._pendingGroups){
        const pi = window._pendingGroups.indexOf(groupName);
        if(pi>=0) window._pendingGroups[pi] = newName;
      }
      persistPages();
    }
    renderNav();
  };
  input.onblur = commit;
  input.onkeydown = e2=>{
    if(e2.key==='Enter') input.blur();
    if(e2.key==='Escape'){ input.value=groupName; input.blur(); }
    e2.stopPropagation();
  };
}

function startGroupRenameByIdx(idx){
  const p = pages[idx];
  if(!p) return;
  openInputModal(`"${p.group}" ê·¸ë£¹ëª… ë³€ê²½`, p.group, (newName)=>{
    if(!newName?.trim() || newName.trim()===p.group) return;
    const oldName = p.group;
    pages.forEach(pg=>{ if(pg.group===oldName) pg.group=newName.trim(); });
    if(window._pendingGroups){
      const pi = window._pendingGroups.indexOf(oldName);
      if(pi>=0) window._pendingGroups[pi] = newName.trim();
    }
    renderNav();
    persistPages();
  });
}

// ì™¸ë¶€ í´ë¦­ ì‹œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë‹«ê¸°
document.addEventListener('click', ()=>closeCtxMenu());
document.addEventListener('contextmenu', e=>{
  if(!e.target.closest('.nav-item')) closeCtxMenu();
});

function deleteCurrentPage(){
  if(pages.length===1){ alert('ë§ˆì§€ë§‰ í˜ì´ì§€ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
  pages.splice(currentIdx,1);
  currentIdx = Math.min(currentIdx, pages.length-1);
  closeDeleteConfirm();
  renderAll();
  persistPages();
}

function openDeleteConfirm(){
  document.getElementById('deleteTargetName').textContent =
    '"' + pages[currentIdx].name + '"  (' + pages[currentIdx].screenId + ')';
  document.getElementById('deleteModal').classList.remove('hidden');
}
function closeDeleteConfirm(){
  document.getElementById('deleteModal').classList.add('hidden');
}
function confirmDelete(){
  deleteCurrentPage();
}

// ============================================================
//  ë²„ì „ ìŠ¤ëƒ…ìƒ· (íˆìŠ¤í† ë¦¬)
// ============================================================
// ê° í˜ì´ì§€ì— history ë°°ì—´ì„ ë¶™ì„: [{ver, label, html, notes, ts}]
const MAX_HISTORY = 20;

function saveSnapshot(label){
  const p = pages[currentIdx];
  if(!p.history) p.history = [];
  const snap = {
    ver: 'v' + (p.history.length + 1) + '.0',
    label,
    html: p.generatedHTML || null,
    notes: JSON.parse(JSON.stringify(p.notes)),
    ts: new Date().toLocaleString('ko-KR', {month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),
    author: 'ê¸°íšì'
  };
  p.history.unshift(snap);
  if(p.history.length > MAX_HISTORY) p.history.pop();
  persistPages(); // â† ìë™ ì €ì¥
}

function openHistoryModal(){
  const p = pages[currentIdx];
  document.getElementById('historyPageName').textContent = p.name + ' Â· ' + p.screenId;

  const list = document.getElementById('historyList');
  const hist = p.history || [];

  if(!hist.length){
    list.innerHTML = '<div class="history-empty">ì €ì¥ëœ ë²„ì „ì´ ì—†ìŠµë‹ˆë‹¤.<br>AIë¡œ í™”ë©´ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ë©´<br>ìë™ìœ¼ë¡œ ë²„ì „ì´ ì €ì¥ë©ë‹ˆë‹¤.</div>';
  } else {
    list.innerHTML = hist.map((h, i) => `
      <div class="hcard ${i===0?'current':''}">
        <div class="hcard-left">
          <div class="hcard-ver">${h.ver}</div>
          <div class="hcard-desc">${h.label}</div>
          <div class="hcard-meta">${h.author} Â· ${h.ts} Â· ë©”ëª¨ ${h.notes.length}ê°œ</div>
        </div>
        <button class="hcard-restore" onclick="restoreSnapshot(${i})" ${i===0?'disabled':''}>
          ${i===0 ? 'í˜„ì¬' : 'â†º ë³µì›'}
        </button>
      </div>`).join('');
  }

  document.getElementById('historyModal').classList.remove('hidden');
}

function closeHistoryModal(){
  document.getElementById('historyModal').classList.add('hidden');
}

function restoreSnapshot(idx){
  const p = pages[currentIdx];
  const snap = p.history[idx];
  if(!snap) return;

  // í˜„ì¬ ìƒíƒœë¥¼ ìƒˆ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ë¨¼ì € ì €ì¥ (ë³µì› ì „)
  saveSnapshot('ë³µì› ì „ ìë™ì €ì¥');

  p.generatedHTML = snap.html;
  p.notes = JSON.parse(JSON.stringify(snap.notes));

  // íˆìŠ¤í† ë¦¬ ëª©ë¡ì—ì„œ ë³µì›ëœ í•­ëª©ì„ ë§¨ ì•ìœ¼ë¡œ ë³µì‚¬í•´ì„œ ìƒˆ ë²„ì „ìœ¼ë¡œ ì¶”ê°€
  const restored = {
    ver: 'v' + (p.history.length) + '.0',
    label: snap.ver + ' ë²„ì „ìœ¼ë¡œ ë³µì›',
    html: snap.html,
    notes: JSON.parse(JSON.stringify(snap.notes)),
    ts: new Date().toLocaleString('ko-KR', {month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),
    author: 'ê¸°íšì'
  };
  p.history.unshift(restored);

  closeHistoryModal();
  renderAll();
  persistPages();
}

function updateCurrentPageName(val){
  pages[currentIdx].name = val;
  renderNav();
  persistPages();
}
function updateMetaField(field,val){
  pages[currentIdx][field] = val;
  renderPad();
  renderNav();
  persistPages();
}

// ============================================================
//  ì •ì±… ë©”ëª¨
// ============================================================
function filterNotes(tag, el){
  noteFilter = tag;
  document.querySelectorAll('.fchip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  renderPad();
}

function toggleCompose(){
  composing = !composing;
  document.getElementById('padCompose').classList.toggle('open', composing);
  if(!composing){
    document.getElementById('composeText').value='';
    selectedTag=null;
    document.querySelectorAll('.ctag').forEach(b=>b.className='ctag');
  }
}

function selTag(btn){
  document.querySelectorAll('.ctag').forEach(b=>b.className='ctag');
  selectedTag = btn.dataset.tag;
  btn.classList.add('sel-'+selectedTag);
}

function addNote(){
  const text = document.getElementById('composeText').value.trim();
  if(!text){ alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if(!selectedTag){ alert('íƒœê·¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
  const now = new Date();
  const date = `${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
  pages[currentIdx].notes.unshift({id:noteNextId++, tag:selectedTag, text, author:'ê¸°íšì', date, resolved:false});
  toggleCompose();
  renderPad();
  persistPages();
}

function delNote(id){
  if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  pages[currentIdx].notes = pages[currentIdx].notes.filter(n=>n.id!==id);
  renderPad();
  persistPages();
}

function toggleResolve(id){
  const n = pages[currentIdx].notes.find(n=>n.id===id);
  if(n){ n.resolved=!n.resolved; renderPad(); persistPages(); }
}

function editNote(id){
  const n = pages[currentIdx].notes.find(n=>n.id===id);
  if(!n) return;
  const el = document.getElementById('nb-'+id);
  el.innerHTML=`<textarea style="width:100%;background:var(--surface-3);border:1px solid var(--accent);border-radius:4px;color:var(--text-primary);font-size:12px;font-family:var(--font);padding:6px 8px;resize:vertical;min-height:56px;outline:none;">${n.text}</textarea>
    <div style="display:flex;gap:5px;margin-top:5px;justify-content:flex-end">
      <button onclick="cancelEdit(${id})" style="background:none;border:1px solid var(--border);color:var(--text-muted);border-radius:4px;padding:2px 9px;font-size:11px;cursor:pointer;">ì·¨ì†Œ</button>
      <button onclick="saveEdit(${id})" style="background:var(--accent);color:#fff;border:none;border-radius:4px;padding:2px 9px;font-size:11px;cursor:pointer;font-weight:600;">ì €ì¥</button>
    </div>`;
}
function saveEdit(id){
  const n  = pages[currentIdx].notes.find(n=>n.id===id);
  const ta = document.querySelector('#nb-'+id+' textarea');
  if(n&&ta){ n.text=ta.value.trim(); renderPad(); persistPages(); }
}
function cancelEdit(id){ renderPad(); }

// ============================================================
//  AI í™”ë©´ ìƒì„±
// ============================================================
function openAiInput(){
  const fw = document.getElementById('frameWrapper');
  fw.className = 'frame-empty';
  fw.innerHTML = `
    <div class="ai-input-overlay">
      <div class="ai-input-title">âœ¦ í™”ë©´ ìƒì„±</div>
      <textarea class="ai-input-box" id="aiPromptBox"
        placeholder="ì˜ˆ: ê³µì§€ì‚¬í•­ ëª©ë¡ í™”ë©´ (ì–´ë“œë¯¼). ìƒë‹¨ì— ê²€ìƒ‰ í•„í„°(ì œëª©, ê¸°ê°„), í…Œì´ë¸”ì— ë²ˆí˜¸/ì œëª©/ì‘ì„±ì/ë“±ë¡ì¼/ìƒíƒœ ì»¬ëŸ¼, ë“±ë¡ ë²„íŠ¼ ìˆìŒ."
        onkeydown="if(event.key==='Enter'&&event.ctrlKey) submitAiGenerate()"></textarea>
      <div class="ai-hint">ğŸ’¡ í™”ë©´ ìœ í˜•, ì£¼ìš” ì»´í¬ë„ŒíŠ¸, ì»¬ëŸ¼ëª…, ë²„íŠ¼ ë“±ì„ êµ¬ì²´ì ìœ¼ë¡œ ì ì„ìˆ˜ë¡ ì •í™•í•˜ê²Œ ë§Œë“¤ì–´ì¤˜ìš” Â· Ctrl+Enterë¡œ ìƒì„±</div>
      <div class="ai-input-actions">
        <button class="ai-input-cancel" onclick="renderCanvas()">ì·¨ì†Œ</button>
        <button class="ai-input-submit" id="aiSubmitBtn" onclick="submitAiGenerate()">âœ¦ ìƒì„±í•˜ê¸°</button>
      </div>
    </div>`;
  setTimeout(()=> document.getElementById('aiPromptBox')?.focus(), 50);
}

function openAiEdit(){
  const p = pages[currentIdx];

  // ë‚´ì¥ ìƒ˜í”Œ í™”ë©´ë„ ì§€ì› - generatedHTML ì—†ìœ¼ë©´ í˜„ì¬ ë Œë”ëœ HTMLì„ ê°€ì ¸ì˜´
  if(!p.generatedHTML){
    const fw = document.getElementById('frameWrapper');
    const html = getPageHTML(p);
    if(!html){ alert('ìˆ˜ì •í•  í™”ë©´ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
    p.generatedHTML = html; // ì´í›„ë¶€í„°ëŠ” generatedHTMLë¡œ ê´€ë¦¬
  }

  // í”„ë ˆì„ ìœ„ì— ì˜¤ë²„ë ˆì´ ëª¨ë‹¬ë¡œ ë„ì›€ (í™”ë©´ DOM ìœ ì§€)
  const existing = document.getElementById('aiEditOverlay');
  if(existing) existing.remove();

  const overlay = document.createElement('div');
  overlay.id = 'aiEditOverlay';
  overlay.style.cssText = [
    'position:fixed;inset:0;z-index:500;',
    'background:rgba(7,9,18,.75);backdrop-filter:blur(4px);',
    'display:flex;align-items:center;justify-content:center;'
  ].join('');
  overlay.innerHTML = `
    <div style="background:#131722;border:1px solid #2e3350;border-radius:14px;width:620px;padding:28px;box-shadow:0 24px 60px rgba(0,0,0,.6);">
      <div style="font-size:15px;font-weight:700;color:#e8ecf4;margin-bottom:16px;">âœ¦ AI ìˆ˜ì •</div>
      <textarea id="aiEditBox" style="width:100%;box-sizing:border-box;height:100px;background:#0f1117;border:1px solid #2e3350;border-radius:8px;color:#e8ecf4;font-size:13px;font-family:Pretendard,sans-serif;padding:12px;resize:vertical;outline:none;"
        placeholder="ì˜ˆ: ì–´ë“œë¯¼ ì»¬ëŸ¼ ì‚­ì œ / ê²€ìƒ‰ í•„í„°ì— ìƒíƒœ ë“œë¡­ë‹¤ìš´ ì¶”ê°€ / ë²„íŠ¼ ìƒ‰ìƒ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½"
        onkeydown="if(event.key==='Enter'&&event.ctrlKey){event.preventDefault();doAiModify();}"></textarea>
      <div style="font-size:11px;color:#505878;margin-top:6px;">ğŸ’¡ Ctrl+Enterë¡œ ìˆ˜ì •</div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button onclick="closeAiEditOverlay()" style="padding:8px 18px;border-radius:6px;background:#1e2235;border:1px solid #2e3350;color:#8892b0;cursor:pointer;font-size:13px;font-family:Pretendard,sans-serif;">ì·¨ì†Œ</button>
        <button onclick="doAiModify()" style="padding:8px 20px;border-radius:6px;background:#4f8ef7;border:none;color:#fff;cursor:pointer;font-size:13px;font-weight:600;font-family:Pretendard,sans-serif;">âœ¦ ìˆ˜ì •í•˜ê¸°</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  setTimeout(() => document.getElementById('aiEditBox')?.focus(), 50);
}

function closeAiEditOverlay(){
  const el = document.getElementById('aiEditOverlay');
  if(el) el.remove();
}

async function doAiModify(){
  const prompt = document.getElementById('aiEditBox')?.value.trim();
  if(!prompt){ alert('ìˆ˜ì • ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const p = pages[currentIdx];
  // p.generatedHTML ì„ ì§ì ‘ ì†ŒìŠ¤ë¡œ ì‚¬ìš© (DOM íŒŒê´´ ì—†ì´)
  const sourceHTML = p.generatedHTML;
  if(!sourceHTML){ alert('ìˆ˜ì •í•  í™”ë©´ì´ ì—†ìŠµë‹ˆë‹¤.'); closeAiEditOverlay(); return; }

  closeAiEditOverlay();

  // ë¡œë”© í‘œì‹œ
  const fw = document.getElementById('frameWrapper');
  fw.className = 'frame-empty';
  fw.innerHTML = `
    <div class="ai-generating">
      <div class="ai-gen-spinner"></div>
      <div class="ai-gen-text">âœ¦ ìˆ˜ì •í•˜ê³  ìˆì–´ìš”...</div>
      <div class="ai-gen-prompt">"${prompt.length>60?prompt.slice(0,60)+'â€¦':prompt}"</div>
    </div>`;

  const system = 'ë‹¹ì‹ ì€ HTML DOM íŒ¨ì¹˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n'
    + 'ì•„ë˜ HTMLì„ ë¶„ì„í•˜ê³  ìˆ˜ì • ìš”ì²­ì— ë§ëŠ” íŒ¨ì¹˜ë¥¼ JSON ë°°ì—´ë¡œ ë°˜í™˜í•˜ì„¸ìš”.\n'
    + '\n'
    + 'ë°˜í™˜ í˜•ì‹ (```json ë°°ì—´ë§Œ, ì„¤ëª… ì—†ì´):\n'
    + '[{"selector":"CSSì…€ë ‰í„°","action":"replaceInnerHTML|replaceOuterHTML|insertAfter|insertBefore|remove|setAttribute","value":"ìƒˆHTML","attrName":"ì†ì„±ëª…(setAttributeë§Œ)"}]\n'
    + '\n'
    + 'ê·œì¹™:\n'
    + '- selectorëŠ” HTMLì— ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê²ƒë§Œ. classê°€ ìˆìœ¼ë©´ ë°˜ë“œì‹œ í¬í•¨\n'
    + '- ì»¬ëŸ¼ ì‚­ì œ: theadì˜ thì™€ tbody ê° trì˜ tdë¥¼ indexë¡œ ì°¾ì•„ remove\n'
    + '  ì˜ˆì‹œ: {"selector":".my-table thead tr","action":"replaceInnerHTML","value":"<th>ë‚¨ì€ì»¬ëŸ¼1</th><th>ë‚¨ì€ì»¬ëŸ¼2</th>"}\n'
    + '        {"selector":".my-table tbody tr","action":"replaceInnerHTML","value":"ê¸°ì¡´tdì—ì„œí•´ë‹¹ì»¬ëŸ¼ì œì™¸í•œHTML"}\n'
    + '- ìŠ¤íƒ€ì¼/ìƒ‰ìƒ/í°íŠ¸/ë ˆì´ì•„ì›ƒ ë³€ê²½ ê¸ˆì§€\n'
    + '- ìˆ˜ì • ë²”ìœ„ ìµœì†Œí™”';

  const user = 'ê¸°ì¡´ HTML:\n```html\n' + sourceHTML + '\n```\n\nìˆ˜ì • ìš”ì²­: ' + prompt;

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:3000,
        system,
        messages:[{role:'user',content:user}]
      })
    });
    const data = await res.json();
    const text = data.content?.map(b=>b.text||'').join('')||'';

    const match = text.match(/```json\s*([\s\S]*?)```/);
    if(!match) throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨: ' + text.slice(0,200));
    let patches = JSON.parse(match[1].trim());
    if(!Array.isArray(patches)) patches = [patches];

    saveSnapshot('ìˆ˜ì • ì „ ìë™ì €ì¥');

    // ì›ë³¸ HTMLì„ íŒŒì„œë¡œ DOM ë³€í™˜ í›„ íŒ¨ì¹˜ ì ìš©
    const parser = new DOMParser();
    const doc = parser.parseFromString(sourceHTML, 'text/html');
    const root = doc.body;

    const failed = applyPatches(root, patches);

    // íŒ¨ì¹˜ëœ HTMLì„ ì €ì¥
    const patchedHTML = root.innerHTML;
    p.generatedHTML = patchedHTML;
    p.aiPrompt = (p.aiPrompt||'') + '\n[ìˆ˜ì •] ' + prompt;
    saveSnapshot('AI ìˆ˜ì •: ' + prompt.slice(0,40) + (prompt.length>40?'â€¦':''));

    // í™”ë©´ ë‹¤ì‹œ ë Œë”
    renderCanvas();

    if(failed.length){
      console.warn('íŒ¨ì¹˜ ì‹¤íŒ¨:', JSON.stringify(failed));
      showToast('ì¼ë¶€ í•­ëª©ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.');
    }

  } catch(e){
    console.error(e);
    renderCanvas();
    alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ' + e.message);
  }
}

function openAiRegen(){
  const p = pages[currentIdx];
  const fw = document.getElementById('frameWrapper');
  fw.className = 'frame-empty';
  fw.innerHTML = `
    <div class="ai-input-overlay">
      <div class="ai-input-title">â†º ì¬ìƒì„±</div>
      <textarea class="ai-input-box" id="aiPromptBox"
        placeholder="ì¶”ê°€ ì§€ì‹œì‚¬í•­ì„ ì…ë ¥í•˜ê±°ë‚˜ ë¹„ì›Œë‘ë©´ ì›ë˜ ëª…ë ¹ìœ¼ë¡œ ì¬ìƒì„±í•©ë‹ˆë‹¤."
        onkeydown="if(event.key==='Enter'&&event.ctrlKey) submitAiRegen()"></textarea>
      <div class="ai-hint">ğŸ’¡ ë¹„ì›Œë‘ë©´ ì €ì¥ëœ ëª…ë ¹ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±í•´ìš”</div>
      <div class="ai-input-actions">
        <button class="ai-input-cancel" onclick="renderCanvas()">ì·¨ì†Œ</button>
        <button class="ai-input-submit" id="aiSubmitBtn" onclick="submitAiRegen()">â†º ì¬ìƒì„±</button>
      </div>
    </div>`;
  setTimeout(()=> document.getElementById('aiPromptBox')?.focus(), 50);
}

function showGenerating(prompt){
  const fw = document.getElementById('frameWrapper');
  fw.className = 'frame-empty';
  fw.innerHTML = `
    <div class="ai-generating">
      <div class="ai-gen-spinner"></div>
      <div class="ai-gen-text">âœ¦ í™”ë©´ì„ ìƒì„±í•˜ê³  ìˆì–´ìš”...</div>
      <div class="ai-gen-prompt">"${prompt.length>60 ? prompt.slice(0,60)+'â€¦' : prompt}"</div>
    </div>`;
}

async function callClaudeForHTML(systemPrompt, userPrompt){
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      model:'claude-sonnet-4-20250514',
      max_tokens:4000,
      system: systemPrompt,
      messages:[{role:'user', content: userPrompt}]
    })
  });
  const data = await res.json();
  const text = data.content?.map(b=> b.text||'').join('') || '';
  // HTML ë¸”ë¡ ì¶”ì¶œ
  const match = text.match(/```html\s*([\s\S]*?)```/);
  if(match) return match[1].trim();
  // html íƒœê·¸ ì§ì ‘ í¬í•¨ ì‹œ
  const divMatch = text.match(/<div[\s\S]*<\/div>/);
  if(divMatch) return divMatch[0];
  return text.trim();
}

async function submitAiGenerate(){
  const prompt = document.getElementById('aiPromptBox')?.value.trim();
  if(!prompt){ alert('ëª…ë ¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const p = pages[currentIdx];
  p.aiPrompt = prompt; // ì¬ìƒì„±ìš© ì €ì¥
  showGenerating(prompt);

  const system = 'ë‹¹ì‹ ì€ ì–´ë“œë¯¼/ì›¹ ê¸°íš í™”ë©´ì„ HTMLë¡œ ë§Œë“œëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n'
    + 'ë‹¤ìŒ ê·œì¹™ì„ ë°˜ë“œì‹œ ì§€ì¼œì£¼ì„¸ìš”:\n'
    + '- ë‹¤í¬ í…Œë§ˆ ì–´ë“œë¯¼ UI (ë°°ê²½:#0f1117, ì¹´ë“œ:#1a1d27, í…Œë‘ë¦¬:#2e3350, í…ìŠ¤íŠ¸:#e8ecf4)\n'
    + '- í°íŠ¸: Pretendard, Noto Sans KR, sans-serif\n'
    + '- ì¸ë¼ì¸ CSS ë˜ëŠ” <style> íƒœê·¸ì— ëª¨ë“  ìŠ¤íƒ€ì¼ í¬í•¨ (ì™¸ë¶€ CSS ë¶ˆê°€)\n'
    + '- ìƒ˜í”Œ ë°ì´í„° 5~10ê°œ í¬í•¨\n'
    + '- í™”ë©´ID=' + p.screenId + ', í™”ë©´ëª…=' + p.name + ', ê²½ë¡œ=' + p.path + '\n'
    + '- ì‘ë‹µì€ ë°˜ë“œì‹œ ```html ë¸”ë¡ìœ¼ë¡œ ê°ì‹¼ ì™„ì„±ëœ HTMLë§Œ ë°˜í™˜ (ì„¤ëª… ì—†ì´)\n'
    + '- min-height: 600px ì´ìƒ';

  const user = `ë‹¤ìŒ í™”ë©´ì„ HTMLë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”:\n\n${prompt}`;

  try {
    const html = await callClaudeForHTML(system, user);
    if(p.generatedHTML) saveSnapshot('AI ìƒì„± ì „ ìë™ì €ì¥');
    p.generatedHTML = html;
    saveSnapshot('AI ìƒì„±: ' + prompt.slice(0,40) + (prompt.length>40?'â€¦':''));
    renderCanvas();
  } catch(e) {
    console.error(e);
    document.getElementById('frameWrapper').innerHTML = `
      <div class="frame-empty">
        <div class="frame-empty-icon" style="color:var(--danger)">âš </div>
        <div style="color:var(--danger);font-weight:600">ìƒì„± ì‹¤íŒ¨</div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:4px">${e.message}</div>
        <button class="frame-empty-cta" style="margin-top:12px" onclick="openAiInput()">ë‹¤ì‹œ ì‹œë„</button>
      </div>`;
  }
}

function applyPatches(container, patches){
  const failed = [];
  patches.forEach(patch => {
    try {
      // nth-child + remove: í…Œì´ë¸” ì»¬ëŸ¼ ì‚­ì œ
      if(patch.action === 'remove' && /nth-child\(\d+\)/.test(patch.selector)){
        const colIdx = parseInt(patch.selector.match(/nth-child\((\d+)\)/)[1]);
        const rowSel = patch.selector.replace(/\s*[\w.#[\]]+:nth-child\(\d+\)\s*$/, '').trim() || 'tr';
        let rows = container.querySelectorAll(rowSel);
        if(!rows.length) rows = container.querySelectorAll('tr');
        if(rows.length){
          rows.forEach(row => { const c = row.children[colIdx-1]; if(c) c.remove(); });
          return;
        }
        failed.push(patch); return;
      }

      let els = container.querySelectorAll(patch.selector);
      if(!els.length){
        const tokens = patch.selector.trim().split(/\s+/);
        if(tokens.length > 1) els = container.querySelectorAll(tokens[tokens.length-1]);
      }
      if(!els.length && patch.selector.includes('.')){
        const cls = patch.selector.match(/\.[a-zA-Z0-9_-]+/g);
        if(cls) els = container.querySelectorAll(cls.join(''));
      }
      if(!els.length){ failed.push(patch); return; }

      els.forEach(el => {
        switch(patch.action){
          case 'replaceInnerHTML':  el.innerHTML = patch.value; break;
          case 'replaceOuterHTML':  el.outerHTML = patch.value; break;
          case 'insertAfter':       el.insertAdjacentHTML('afterend', patch.value); break;
          case 'insertBefore':      el.insertAdjacentHTML('beforebegin', patch.value); break;
          case 'remove':            el.remove(); break;
          case 'setAttribute':      el.setAttribute(patch.attrName, patch.value); break;
          default:                  el.innerHTML = patch.value;
        }
      });
    } catch(err){ failed.push(patch); }
  });
  return failed;
}

async function retryFailedPatches(fw, wrap, failed, cleanHTML, p){
  const tables = wrap.querySelectorAll('table');
  let tableHints = '';
  tables.forEach((tbl, ti) => {
    const cls = tbl.className ? ' class="'+tbl.className+'"' : '';
    tableHints += 'table'+(ti+1)+': <table'+cls+'>\n';
    const ths = tbl.querySelectorAll('thead th');
    if(ths.length) tableHints += '  th: ' + [...ths].map((h,i)=>'['+(i+1)+']'+h.textContent.trim()).join(', ')+'\n';
  });
  const classHints = [...new Set([...wrap.querySelectorAll('[class]')].slice(0,40).map(el=>
    el.tagName.toLowerCase()+'.'+el.className.trim().split(/\s+/).join('.')
  ))].join('\n');
  const failedDesc = failed.map(f=>'- selector="'+f.selector+'" action='+f.action).join('\n');
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ model:'claude-sonnet-4-20250514', max_tokens:1000,
        system:'HTML DOM íŒ¨ì¹˜ ì „ë¬¸ê°€. ì‹¤íŒ¨í•œ ì…€ë ‰í„°ë¥¼ DOM íŒíŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì¬ì‘ì„±í•´ ```json ë°°ì—´ ë°˜í™˜.',
        messages:[{role:'user', content:'í…Œì´ë¸”:\n'+tableHints+'\nclass:\n'+classHints+'\n\nì‹¤íŒ¨:\n'+failedDesc+'\n\nì˜¬ë°”ë¥¸ ì…€ë ‰í„°ë¡œ ì¬ì‘ì„±í•˜ì„¸ìš”.'}]
      })
    });
    const data = await res.json();
    const text = data.content?.map(b=>b.text||'').join('')||'';
    const match = text.match(/```json\s*([\s\S]*?)```/);
    if(!match){ showToast('ì¬ì‹œë„ ì‹¤íŒ¨ - ë” êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•´ë³´ì„¸ìš”'); return; }
    let rp = JSON.parse(match[1].trim());
    if(!Array.isArray(rp)) rp = [rp];
    const still = applyPatches(wrap, rp);
    p.generatedHTML = wrap.innerHTML;
    ensureEditBar(fw);
    if(still.length) showToast('ì¼ë¶€ ìˆ˜ì •ì´ ì ìš©ë˜ì§€ ì•Šì•˜ì–´ìš”.');
  } catch(e){ showToast('ìˆ˜ì • ì¼ë¶€ê°€ ì ìš©ë˜ì§€ ì•Šì•˜ì–´ìš”.'); }
}

function ensureEditBar(fw){
  // frame-wrapper ì•ˆ ê¸°ì¡´ bar ì œê±°
  fw.querySelectorAll('.frame-edit-bar').forEach(el => el.remove());

  // frame-outerì— ë¶™ì—¬ì„œ AI HTMLì˜ <style> ì˜í–¥ ë°–ìœ¼ë¡œ ë¶„ë¦¬
  const outer = fw.closest('.frame-outer') || fw.parentElement;
  if(!outer) return;
  outer.querySelectorAll('.frame-edit-bar').forEach(el => el.remove());

  const bar = document.createElement('div');
  bar.className = 'frame-edit-bar';
  bar.innerHTML = '<button class="fedit-btn fedit-ai" onclick="openAiEdit()">âœ¦ AI ìˆ˜ì •</button>'
    + '<button class="fedit-btn fedit-regen" onclick="openAiRegen()">â†º ì¬ìƒì„±</button>';
  outer.appendChild(bar);
}

function showToast(msg){
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);'
    + 'background:#2a2f45;border:1px solid #f59e0b;color:#fbbf24;'
    + 'padding:10px 18px;border-radius:8px;font-size:12px;z-index:9999;'
    + 'box-shadow:0 4px 20px rgba(0,0,0,.4);max-width:400px;text-align:center;';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 4000);
}

async function submitAiRegen(){
  const extra = document.getElementById('aiPromptBox')?.value.trim();
  const p = pages[currentIdx];
  const prompt = extra || p.aiPrompt || '';
  if(!prompt){ openAiInput(); return; }
  if(extra) p.aiPrompt = prompt;
  showGenerating(prompt);

  const system = 'ë‹¹ì‹ ì€ ì–´ë“œë¯¼/ì›¹ ê¸°íš í™”ë©´ì„ HTMLë¡œ ë§Œë“œëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n'
    + 'ë‹¤í¬ í…Œë§ˆ ì–´ë“œë¯¼ UI (ë°°ê²½:#0f1117, ì¹´ë“œ:#1a1d27, í…Œë‘ë¦¬:#2e3350), Pretendard í°íŠ¸, style íƒœê·¸ CSSë§Œ ì‚¬ìš©, ìƒ˜í”Œ ë°ì´í„° í¬í•¨.\n'
    + 'ì‘ë‹µì€ ë°˜ë“œì‹œ ```html ë¸”ë¡ìœ¼ë¡œ ê°ì‹¼ ì™„ì„±ëœ HTMLë§Œ ë°˜í™˜ (ì„¤ëª… ì—†ì´).';

  const user = `ë‹¤ìŒ í™”ë©´ì„ HTMLë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”:\n\n${prompt}`;

  try {
    const html = await callClaudeForHTML(system, user);
    saveSnapshot('ì¬ìƒì„± ì „ ìë™ì €ì¥');
    p.generatedHTML = html;
    saveSnapshot('ì¬ìƒì„±: ' + prompt.slice(0,40) + (prompt.length>40?'â€¦':''));
    renderCanvas();
  } catch(e) {
    console.error(e);
    alert('ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.message);
    renderCanvas();
  }
}

// ============================================================
//  AI ì¼ê´„ ìˆ˜ì •
// ============================================================
function openBulkModal(){
  // í™”ë©´ ëª©ë¡ ë Œë”
  const list = document.getElementById('bulkScopeList');
  list.innerHTML = pages.map((p, i) => `
    <div class="bulk-scope-item">
      <input type="checkbox" id="bsc-${i}" value="${i}" checked>
      <label for="bsc-${i}">${p.name}</label>
      <span class="scope-id">${p.screenId}</span>
    </div>`).join('');

  document.getElementById('bulkLog').style.display = 'none';
  document.getElementById('bulkLog').innerHTML = '';
  document.getElementById('bulkProgress').textContent = '';
  document.getElementById('bulkRunBtn').disabled = false;
  document.getElementById('bulkPromptBox').value = '';
  document.getElementById('bulkModal').classList.remove('hidden');
  setTimeout(() => document.getElementById('bulkPromptBox')?.focus(), 100);
}

function closeBulkModal(){
  document.getElementById('bulkModal').classList.add('hidden');
}

function bulkSelectAll(checked){
  document.querySelectorAll('#bulkScopeList input[type=checkbox]').forEach(cb => cb.checked = checked);
}

function bulkLog(msg, type=''){
  const log = document.getElementById('bulkLog');
  log.style.display = 'block';
  const line = document.createElement('div');
  line.className = 'bulk-log-line ' + type;
  line.textContent = msg;
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
}

async function runBulkModify(){
  const prompt = document.getElementById('bulkPromptBox')?.value.trim();
  if(!prompt){ alert('ìˆ˜ì • ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const checked = [...document.querySelectorAll('#bulkScopeList input[type=checkbox]:checked')];
  if(!checked.length){ alert('ì ìš©í•  í™”ë©´ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

  const btn = document.getElementById('bulkRunBtn');
  btn.disabled = true;

  const log = document.getElementById('bulkLog');
  log.innerHTML = '';
  log.style.display = 'block';

  const targets = checked.map(cb => parseInt(cb.value));
  let done = 0;

  const system = 'ë‹¹ì‹ ì€ HTML DOM íŒ¨ì¹˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n'
    + 'ì•„ë˜ HTMLì„ ë¶„ì„í•˜ê³  ìˆ˜ì • ìš”ì²­ì— ë§ëŠ” ìµœì†Œí•œì˜ íŒ¨ì¹˜ë¥¼ JSON ë°°ì—´ë¡œ ë°˜í™˜í•˜ì„¸ìš”.\n'
    + 'ë°˜í™˜ í˜•ì‹: ```json ë°°ì—´ (ì„¤ëª… ì—†ì´)\n'
    + '[{"selector":"CSSì…€ë ‰í„°","action":"replaceInnerHTML|insertAfter|insertBefore|remove|setAttribute","value":"ìƒˆHTML","attrName":"ì†ì„±ëª…"}]\n'
    + 'ê·œì¹™: ê¸°ì¡´ ìŠ¤íƒ€ì¼/ìƒ‰ìƒ/ë ˆì´ì•„ì›ƒ ë³€ê²½ ê¸ˆì§€. ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ì…€ë ‰í„°ë§Œ ì‚¬ìš©. ìˆ˜ì • ë²”ìœ„ ìµœì†Œí™”.';

  for(const idx of targets){
    const p = pages[idx];
    // generatedHTML ì—†ìœ¼ë©´ ë‚´ì¥ HTML ê°€ì ¸ì˜¤ê¸°
    if(!p.generatedHTML){
      const html = getPageHTML(p);
      if(html) p.generatedHTML = html;
    }
    const sourceHTML = p.generatedHTML;
    if(!sourceHTML){
      bulkLog(`[${p.screenId}] ${p.name} â€” í™”ë©´ ì—†ìŒ, ê±´ë„ˆëœ€`, 'err');
      done++; continue;
    }

    bulkLog(`[${p.screenId}] ${p.name} ìˆ˜ì • ì¤‘...`, 'ing');
    document.getElementById('bulkProgress').innerHTML =
      `<strong>${done}/${targets.length}</strong> ì²˜ë¦¬ ì¤‘`;

    try {
      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          model:'claude-sonnet-4-20250514',
          max_tokens:2000,
          system,
          messages:[{role:'user', content:'ê¸°ì¡´ HTML:\n```html\n'+sourceHTML+'\n```\n\nìˆ˜ì • ìš”ì²­: '+prompt}]
        })
      });
      const data = await res.json();
      const text = data.content?.map(b=>b.text||'').join('')||'';
      const match = text.match(/```json\s*([\s\S]*?)```/);
      if(!match) throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨');

      let patches = JSON.parse(match[1].trim());
      if(!Array.isArray(patches)) patches = [patches];

      // DOMParserë¡œ íŒ¨ì¹˜ ì ìš©
      const parser = new DOMParser();
      const doc = parser.parseFromString(sourceHTML, 'text/html');
      saveSnapshot.call({currentIdx: idx}, 'ì¼ê´„ìˆ˜ì • ì „');

      // pages[idx] ê¸°ì¤€ìœ¼ë¡œ ìŠ¤ëƒ…ìƒ·
      if(!pages[idx].history) pages[idx].history = [];
      pages[idx].history.unshift({
        ver:'v'+(pages[idx].history.length+1)+'.0',
        label:'ì¼ê´„ìˆ˜ì • ì „: '+prompt.slice(0,30),
        html: pages[idx].generatedHTML,
        notes: JSON.parse(JSON.stringify(pages[idx].notes)),
        ts: new Date().toLocaleString('ko-KR',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),
        author:'ê¸°íšì'
      });

      const failed = applyPatches(doc.body, patches);
      pages[idx].generatedHTML = doc.body.innerHTML;

      if(failed.length){
        bulkLog(`[${p.screenId}] ${p.name} â€” ì™„ë£Œ (ì¼ë¶€ ë¯¸ì ìš©: ${failed.length}ê±´)`, 'ok');
      } else {
        bulkLog(`[${p.screenId}] ${p.name} â€” ì™„ë£Œ âœ“`, 'ok');
      }

      // í˜„ì¬ ë³´ê³  ìˆëŠ” í™”ë©´ì´ë©´ ì¦‰ì‹œ ê°±ì‹ 
      if(idx === currentIdx) renderCanvas();

    } catch(e) {
      bulkLog(`[${p.screenId}] ${p.name} â€” ì‹¤íŒ¨: ${e.message}`, 'err');
    }

    done++;
    document.getElementById('bulkProgress').innerHTML =
      `<strong>${done}/${targets.length}</strong> ì™„ë£Œ`;

    // API ê³¼ë¶€í•˜ ë°©ì§€ ë”œë ˆì´
    if(done < targets.length) await new Promise(r => setTimeout(r, 500));
  }

  bulkLog(`â€” ì™„ë£Œ: ${targets.length}ê°œ í™”ë©´ ì²˜ë¦¬ â€”`, '');
  btn.disabled = false;
  persistPages();
}

// ============================================================
//  ì˜ì†ì„± - localStorage
// ============================================================
const STORAGE_KEY = 'planify_projects_v2';

function persistPages(){
  try {
    getCurrentProject().pages = pages;
    getCurrentProject()._pendingGroups = window._pendingGroups || [];
    // ì €ì¥ ì „ ìƒì„±ì¤‘ ìƒíƒœ HTML ì œê±° (ìƒˆë¡œê³ ì¹¨ ì‹œ ìŠ¤í”¼ë„ˆ ë³µì› ë°©ì§€)
    const clean = projects.map(proj => ({
      ...proj,
      pages: proj.pages.map(p => ({
        ...p,
        generatedHTML: (p.generatedHTML && p.generatedHTML.includes('ai-generating'))
          ? null
          : (p.generatedHTML || null),
        history: (p.history||[]).map(h => ({...h}))
      }))
    }));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(clean));
  } catch(e) {
    try {
      const slim = projects.map(proj => ({
        ...proj,
        pages: proj.pages.map(p => ({
          ...p,
          generatedHTML: (p.generatedHTML && p.generatedHTML.includes('ai-generating')) ? null : (p.generatedHTML||null),
          history: (p.history||[]).map(h => ({...h, html: null}))
        }))
      }));
      localStorage.setItem(STORAGE_KEY, JSON.stringify(slim));
    } catch(e2) { console.warn('ì €ì¥ ì‹¤íŒ¨', e2); }
  }
}

function loadPersistedPages(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const saved = JSON.parse(raw);
    if(!Array.isArray(saved) || !saved.length) return false;
    projects = saved.map(proj => ({
      _pendingGroups:[], pages:[], ...proj,
      // ë¡œë“œ ì‹œì—ë„ ìƒì„±ì¤‘ HTML ë°©ì–´ì ìœ¼ë¡œ ì œê±°
      pages: (proj.pages||[]).map(p => ({
        ...p,
        generatedHTML: (p.generatedHTML && p.generatedHTML.includes('ai-generating'))
          ? null : (p.generatedHTML||null)
      }))
    }));
    currentProjectId = projects[0].id;
    pages = getCurrentProject().pages;
    window._pendingGroups = getCurrentProject()._pendingGroups || [];
    return true;
  } catch(e) { return false; }
}

// ============================================================
//  Init
// ============================================================
document.addEventListener('DOMContentLoaded', function(){
  loadPersistedPages();
  document.querySelector('.shell').style.display = 'none';
  showProjectList();
});

</script>


<!-- ê³µìš© í…ìŠ¤íŠ¸ ì…ë ¥ ëª¨ë‹¬ -->
<div class="modal-overlay hidden" id="inputModalOverlay">
  <div class="modal-box" style="width:360px;">
    <div class="modal-title" id="inputModalTitle">ì…ë ¥</div>
    <div class="mform-group" style="margin-bottom:0;">
      <input class="mform-input" id="inputModalField" placeholder="ì´ë¦„ ì…ë ¥...">
    </div>
    <div class="modal-footer" style="margin-top:16px;">
      <button class="mcancel" id="inputModalCancel">ì·¨ì†Œ</button>
      <button class="msubmit" id="inputModalConfirm">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ -->
<div class="ctx-menu" id="ctxMenu">
  <div class="ctx-item" id="ctxMoveGroup">ğŸ“ ê·¸ë£¹ ë³€ê²½</div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" id="ctxRenameGroup">âœï¸ ê·¸ë£¹ëª… ë³€ê²½</div>
</div>

<!-- ê·¸ë£¹ ë³€ê²½ ì„œë¸Œë©”ë‰´ -->
<div class="ctx-menu" id="ctxGroupMenu"></div>

<!-- ì¼ê´„ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="bulk-modal-overlay hidden" id="bulkModal">
  <div class="bulk-modal">
    <div class="bulk-modal-head">
      <div class="bulk-modal-title">âœ¦ AI ì¼ê´„ ìˆ˜ì •</div>
      <div class="bulk-modal-sub">ì„ íƒí•œ í™”ë©´ì— ë™ì¼í•œ ìˆ˜ì •ì„ ì¼ê´„ ì ìš©í•´ìš”</div>
    </div>
    <div class="bulk-modal-body">
      <div>
        <div class="bulk-scope-label">ì ìš© ëŒ€ìƒ í™”ë©´</div>
        <div style="display:flex;gap:8px;margin-bottom:8px;">
          <button onclick="bulkSelectAll(true)" style="font-size:11px;background:none;border:1px solid #2e3350;color:#8892b0;padding:3px 10px;border-radius:4px;cursor:pointer;font-family:var(--font);">ì „ì²´ì„ íƒ</button>
          <button onclick="bulkSelectAll(false)" style="font-size:11px;background:none;border:1px solid #2e3350;color:#8892b0;padding:3px 10px;border-radius:4px;cursor:pointer;font-family:var(--font);">ì „ì²´í•´ì œ</button>
        </div>
        <div class="bulk-scope-list" id="bulkScopeList"></div>
      </div>
      <div>
        <div class="bulk-prompt-label">ìˆ˜ì • ë‚´ìš©</div>
        <textarea class="bulk-prompt-box" id="bulkPromptBox"
          placeholder="ì˜ˆ: ëª¨ë“  í™”ë©´ì˜ ìƒë‹¨ì— 'ë² íƒ€ ì„œë¹„ìŠ¤' ë°°ë„ˆ ì¶”ê°€&#10;ì˜ˆ: ì‚­ì œ ë²„íŠ¼ ìƒ‰ìƒì„ ëª¨ë‘ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½&#10;ì˜ˆ: í…Œì´ë¸” hover ìƒ‰ìƒì„ ì§„í•˜ê²Œ ë³€ê²½"
          onkeydown="if(event.key==='Enter'&&event.ctrlKey){event.preventDefault();runBulkModify();}"></textarea>
        <div style="font-size:11px;color:#505878;margin-top:5px;">ğŸ’¡ Ctrl+Enterë¡œ ì‹¤í–‰ Â· í™”ë©´ë³„ AI ìˆ˜ì •ì´ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©ë¼ìš”</div>
      </div>
      <div class="bulk-log" id="bulkLog"></div>
    </div>
    <div class="bulk-modal-foot">
      <div class="bulk-progress" id="bulkProgress"></div>
      <div class="bulk-actions">
        <button class="bulk-cancel-btn" onclick="closeBulkModal()">ë‹«ê¸°</button>
        <button class="bulk-run-btn" id="bulkRunBtn" onclick="runBulkModify()">âœ¦ ì¼ê´„ ì ìš©</button>
      </div>
    </div>
  </div>
</div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal-overlay hidden" id="deleteModal">
  <div class="modal-box" style="width:380px">
    <div class="modal-title" style="color:var(--danger)">ğŸ—‘ í˜ì´ì§€ ì‚­ì œ</div>
    <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:6px">
      ì•„ë˜ í˜ì´ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
      <strong id="deleteTargetName" style="color:var(--text-primary)"></strong>
    </div>
    <div style="font-size:11px;color:var(--text-muted);background:var(--surface-2);border-radius:var(--r-sm);padding:8px 12px;margin-top:10px">
      âš  ì‚­ì œëœ í˜ì´ì§€ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    </div>
    <div class="modal-footer">
      <button class="mcancel" onclick="closeDeleteConfirm()">ì·¨ì†Œ</button>
      <button class="msubmit" style="background:var(--danger)" onclick="confirmDelete()">ì‚­ì œ</button>
    </div>
  </div>
</div>

<!-- ë²„ì „ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ -->
<div class="modal-overlay hidden" id="historyModal">
  <div class="modal-box" style="width:560px;max-height:80vh;display:flex;flex-direction:column">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div class="modal-title" style="margin:0">ğŸ•“ ë²„ì „ íˆìŠ¤í† ë¦¬</div>
      <div style="font-size:11px;color:var(--text-muted)" id="historyPageName"></div>
    </div>
    <div id="historyList" style="flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-right:4px;max-height:460px"></div>
    <div class="modal-footer">
      <button class="mcancel" onclick="closeHistoryModal()">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- Claude ê²Œì‹œ ë²„ì „ -->

<script>
// Claude ê²Œì‹œ í™˜ê²½ â€” ë¡œê·¸ì¸ ì—†ì´ ë°”ë¡œ ì‹¤í–‰, ëª¨ë“  ê¸°ëŠ¥ ê°œë°©
// (localStorage ë¯¸ì‚¬ìš© â€” ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”)
</script>
</body>
</html>
